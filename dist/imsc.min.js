var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,v,u){g!=Array.prototype&&g!=Object.prototype&&(g[v]=u.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(g,v,u,l){if(v){u=$jscomp.global;g=g.split(".");for(l=0;l<g.length-1;l++){var F=g[l];F in u||(u[F]={});u=u[F]}g=g[g.length-1];l=u[g];v=v(l);v!=l&&null!=v&&$jscomp.defineProperty(u,g,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Math.sign",function(g){return g?g:function(g){g=Number(g);return 0===g||isNaN(g)?g:0<g?1:-1}},"es6","es3");
(function(g){"object"===typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define([],g):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).imsc=g()})(function(){return function(){function g(v,u,l){function F(r,G){if(!u[r]){if(!v[r]){var a="function"==typeof require&&require;if(!G&&a)return a(r,!0);if(k)return k(r,!0);G=Error("Cannot find module '"+r+"'");throw G.code="MODULE_NOT_FOUND",G;}G=
u[r]={exports:{}};v[r][0].call(G.exports,function(a){return F(v[r][1][a]||a)},G,G.exports,g,v,u,l)}return u[r].exports}for(var k="function"==typeof require&&require,r=0;r<l.length;r++)F(l[r]);return F}return g}()({1:[function(g,v,u){(function(l,g,k,r,u){function F(b,a){var e=b.styleAttrs&&b.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"];if("span"===b.kind)!e&&a&&(b.styleAttrs||(b.styleAttrs={}),b.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"]=a);else if(e&&delete b.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"],
b.contents)for(var d=0;d<b.contents.length;d++)F(b.contents[d],e||a)}function a(b){if("contents"in b){var e="styleAttrs"in b?b.styleAttrs[r.byName.ruby.qname]:null;e="span"===b.kind&&("container"===e||"textContainer"===e||"baseContainer"===e);for(var d=b.contents.length-1;0<=d;d--)!e||"styleAttrs"in b.contents[d]&&r.byName.ruby.qname in b.contents[d].styleAttrs?a(b.contents[d]):delete b.contents[d]}}function c(b,a,e,d){var n=d&&"seq"===d.timeContainer,E=0;d&&(E=n&&e?e.end:d.begin);a.begin=a.explicit_begin?
a.explicit_begin+E:E;e=a.begin;d=null;for(var h in a.sets)c(b,a.sets[h],d,a),e="seq"===a.timeContainer?a.sets[h].end:Math.max(e,a.sets[h].end),d=a.sets[h];if("contents"in a)for(var I in a.contents)c(b,a.contents[I],d,a),e="seq"===a.timeContainer?a.contents[I].end:Math.max(e,a.contents[I].end),d=a.contents[I];else e=n?a.begin:Number.POSITIVE_INFINITY;a.end=null!==a.explicit_end&&null!==a.explicit_dur?Math.min(a.begin+a.explicit_dur,E+a.explicit_end):null===a.explicit_end&&null!==a.explicit_dur?a.begin+
a.explicit_dur:null!==a.explicit_end&&null===a.explicit_dur?E+a.explicit_end:e;delete a.explicit_begin;delete a.explicit_dur;delete a.explicit_end;b._registerEvent(a)}function f(b){this.node=b}function h(){this.events=[];this.head=new A;this.body=null}function A(){this.styling=new t;this.layout=new B}function t(){this.styles={};this.initials={}}function y(){this.styleRefs=this.styleAttrs=this.id=null}function v(){this.styleAttrs=null}function B(){this.regions={}}function b(b,a){this.kind="image";
this.src=b;this.type=a}function d(b){this.id=b}function e(b){this.regionID=b}function n(b){this.styleAttrs=b}function C(b){this.sets=b}function p(b){this.contents=b}function m(b,a,e){this.explicit_begin=b;this.explicit_end=a;this.explicit_dur=e}function R(){this.kind="body"}function P(){this.kind="div"}function N(){this.kind="p"}function z(){this.kind="span"}function Q(){this.kind="span"}function w(){this.kind="br"}function K(){}function O(){}function V(b){var a=null;b&&(b=b.attributes["xml:id"]||
b.attributes.id)&&(a=b.value||null);return a}function H(b){return b&&"style"in b.attributes?b.attributes.style.value.split(" "):[]}function S(b,a){var e={};if(null!==b)for(var d in b.attributes){var n=b.attributes[d].uri+" "+b.attributes[d].local,c=r.byQName[n];if(void 0!==c){var h=c.parse(b.attributes[d].value);null!==h?(e[n]=h,c===r.byName.zIndex&&L(a,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):J(a,"Cannot parse styling attribute "+n+" --\x3e "+b.attributes[d].value)}}return e}
function M(b,a,e){for(var d in b.attributes)if(b.attributes[d].uri===a&&b.attributes[d].local===e)return b.attributes[d].value;return null}function aa(b,a){b=M(b,k.ns_tts,"extent");if(null===b)return null;var e=b.split(" ");if(2!==e.length)return L(a,"Malformed extent (ignoring)"),null;b=u.parseLength(e[0]);e=u.parseLength(e[1]);return e&&b?{h:e,w:b}:(L(a,"Malformed extent values (ignoring)"),null)}function T(b,a,e){var d=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,n=/^(\d{2,}):(\d\d):(\d\d):(\d{2,})$/,
c=/^(\d+(?:\.\d+)?)t$/,h=/^(\d+(?:\.\d+)?)ms$/,f=/^(\d+(?:\.\d+)?)s$/,E=/^(\d+(?:\.\d+)?)h$/,I=/^(\d+(?:\.\d+)?)m$/,x,k=null;null!==(x=/^(\d+(?:\.\d+)?)f$/.exec(e))?null!==a&&(k=parseFloat(x[1])/a):null!==(x=c.exec(e))?null!==b&&(k=parseFloat(x[1])/b):null!==(x=h.exec(e))?k=parseFloat(x[1])/1E3:null!==(x=f.exec(e))?k=parseFloat(x[1]):null!==(x=E.exec(e))?k=3600*parseFloat(x[1]):null!==(x=I.exec(e))?k=60*parseFloat(x[1]):null!==(x=d.exec(e))?k=3600*parseInt(x[1])+60*parseInt(x[2])+parseFloat(x[3]):
null!==(x=n.exec(e))&&null!==a&&(k=3600*parseInt(x[1])+60*parseInt(x[2])+parseInt(x[3])+(null===x[4]?0:parseInt(x[4])/a));return k}function W(b,a,e){for(;0<a.styleRefs.length;){var d=a.styleRefs.pop();d in b.styles?(W(b,b.styles[d],e),U(b.styles[d].styleAttrs,a.styleAttrs)):J(e,"Non-existant style id referenced")}}function X(b,a,e,d){for(var n=a.length-1;0<=n;n--){var c=a[n];c in b.styles?U(b.styles[c].styleAttrs,e):J(d,"Non-existant style id referenced")}}function U(b,a){for(var e in b)e in a||(a[e]=
b[e])}function L(b,a){if(b&&b.warn&&b.warn(a))throw a;}function J(b,a){if(b&&b.error&&b.error(a))throw a;}function D(b,a){b&&b.fatal&&b.fatal(a);throw a;}function Y(b,a){for(var e=0,d=b.length-1,n;e<=d;){n=Math.floor((e+d)/2);var c=b[n];if(c<a)e=n+1;else if(c>a)d=n-1;else return{found:!0,index:n}}return{found:!1,index:e}}l.fromXML=function(e,d,n){var C=g.parser(!0,{xmlns:!0}),q=[],I=[],E=[],x=0,p=null;C.onclosetag=function(b){if(q[0]instanceof K)null!==p.head&&null!==p.head.styling&&X(p.head.styling,
q[0].styleRefs,q[0].styleAttrs,d),delete q[0].styleRefs;else if(q[0]instanceof t)for(var a in q[0].styles)W(q[0],q[0].styles[a],d);else if(q[0]instanceof N||q[0]instanceof z){if(1<q[0].contents.length){b=[q[0].contents[0]];for(a=1;a<q[0].contents.length;a++)q[0].contents[a]instanceof Q&&b[b.length-1]instanceof Q?b[b.length-1].text+=q[0].contents[a].text:b.push(q[0].contents[a]);q[0].contents=b}q[0]instanceof z&&1===q[0].contents.length&&q[0].contents[0]instanceof Q&&(q[0].text=q[0].contents[0].text,
delete q[0].contents)}else if(q[0]instanceof f)if(q[0].node.uri===k.ns_tt&&"metadata"===q[0].node.local)x--;else if(0<x&&n&&"onCloseTag"in n)n.onCloseTag();E.shift();I.shift();q.shift()};C.ontext=function(b){if(void 0!==q[0])if(q[0]instanceof z||q[0]instanceof N){if(q[0]instanceof z){var a=q[0].styleAttrs[r.byName.ruby.qname];if("container"===a||"textContainer"===a||"baseContainer"===a)return}a=new Q;a.initFromText(p,q[0],b,E[0],d);q[0].contents.push(a)}else if(q[0]instanceof f&&0<x&&n&&"onText"in
n)n.onText(b)};C.onopentag=function(a){function e(a){k.ttaf_map[a.uri]&&(a.uri=k.ttaf_map[a.uri])}var c=a.attributes["xml:space"];c?E.unshift(c.value):0===E.length?E.unshift("default"):E.unshift(E[0]);(c=a.attributes["xml:lang"])?I.unshift(c.value):0===I.length?I.unshift(""):I.unshift(I[0]);e(a);if(a.attributes)for(var C in a.attributes)a.attributes.hasOwnProperty(C)&&e(a.attributes[C]);if(a.uri===k.ns_tt)if("tt"===a.local)null!==p&&D(d,"Two <tt> elements at ("+this.line+","+this.column+")"),p=new h,
p.initFromNode(a,d),q.unshift(p);else if("head"===a.local)q[0]instanceof h||D(d,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),q.unshift(p.head);else if("styling"===a.local)q[0]instanceof A||D(d,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),q.unshift(p.head.styling);else if("style"===a.local)if(q[0]instanceof t){var m=new y;m.initFromNode(a,d);m.id?p.head.styling.styles[m.id]=m:J(d,"<style> element missing @id attribute");q.unshift(m)}else q[0]instanceof
K?(m=new y,m.initFromNode(a,d),U(m.styleAttrs,q[0].styleAttrs),q.unshift(m)):D(d,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")");else if("initial"===a.local)if(q[0]instanceof t){C=new v;C.initFromNode(a,d);for(m in C.styleAttrs)p.head.styling.initials[m]=C.styleAttrs[m];q.unshift(C)}else D(d,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")");else if("layout"===a.local)q[0]instanceof A||D(d,"Parent of <layout> element is not <head> at "+
this.line+","+this.column+")"),q.unshift(p.head.layout);else if("region"===a.local)q[0]instanceof B||D(d,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")"),m=new K,m.initFromNode(p,a,d),!m.id||m.id in p.head.layout.regions?J(d,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):p.head.layout.regions[m.id]=m,q.unshift(m);else if("body"===a.local)q[0]instanceof h||D(d,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),
null!==p.body&&D(d,"Second <body> element at "+this.line+","+this.column+")"),m=new R,m.initFromNode(p,a,d),p.body=m,q.unshift(m);else if("div"===a.local){q[0]instanceof P||q[0]instanceof R||D(d,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");m=new P;m.initFromNode(p,q[0],a,d);if(C=m.styleAttrs[r.byName.backgroundImage.qname])m.contents.push(new b(C)),delete m.styleAttrs[r.byName.backgroundImage.qname];q[0].contents.push(m);q.unshift(m)}else"image"===a.local?(q[0]instanceof
P||D(d,"Parent of <image> element is not <div> at "+this.line+","+this.column+")"),m=new b,m.initFromNode(p,q[0],a,d),q[0].contents.push(m),q.unshift(m)):"p"===a.local?(q[0]instanceof P||D(d,"Parent of <p> element is not <div> at "+this.line+","+this.column+")"),m=new N,m.initFromNode(p,q[0],a,d),q[0].contents.push(m),q.unshift(m)):"span"===a.local?(q[0]instanceof z||q[0]instanceof N||D(d,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")"),m=new z,m.initFromNode(p,q[0],
a,E[0],d),q[0].contents.push(m),q.unshift(m)):"br"===a.local?(q[0]instanceof z||q[0]instanceof N||D(d,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")"),m=new w,m.initFromNode(p,q[0],a,d),q[0].contents.push(m),q.unshift(m)):"set"===a.local?(q[0]instanceof z||q[0]instanceof N||q[0]instanceof P||q[0]instanceof R||q[0]instanceof K||q[0]instanceof w||D(d,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")"),m=new O,m.initFromNode(p,
q[0],a,d),q[0].sets.push(m),q.unshift(m)):q.unshift(new f(a));else q.unshift(new f(a));if(q[0]instanceof f)if(a.uri===k.ns_tt&&"metadata"===a.local)x++;else if(0<x&&n&&"onOpenTag"in n){m=[];for(var l in a.attributes)m[a.attributes[l].uri+" "+a.attributes[l].local]={uri:a.attributes[l].uri,local:a.attributes[l].local,value:a.attributes[l].value};n.onOpenTag(a.uri,a.local,m)}};C.write(e).close();delete p.head.styling.styles;e=!1;for(var m in p.head.layout.regions){e=!0;break}e||(m=K.prototype.createDefaultRegion(p,
d),p.head.layout.regions[m.id]=m);for(var l in p.head.layout.regions)c(p,p.head.layout.regions[l],null,null);p.body&&c(p,p.body,null,null);p.body&&a(p.body);p.body&&F(p.body);return p};h.prototype.initFromNode=function(a,b){var e=M(a,k.ns_ttp,"cellResolution"),d=15;var n=32;null!==e&&(e=/(\d+) (\d+)/.exec(e),null!==e?(n=parseInt(e[1]),d=parseInt(e[2])):L(b,"Malformed cellResolution value (using initial value instead)"));this.cellLength={h:new u.ComputedLength(0,1/d),w:new u.ComputedLength(1/n,0)};
d=M(a,k.ns_ttp,"frameRate");e=30;null!==d&&(n=/(\d+)/.exec(d),null!==n?e=parseInt(n[1]):L(b,"Malformed frame rate attribute (using initial value instead)"));n=M(a,k.ns_ttp,"frameRateMultiplier");var c=1;null!==n&&(n=/(\d+) (\d+)/.exec(n),null!==n?c=parseInt(n[1])/parseInt(n[2]):L(b,"Malformed frame rate multiplier attribute (using initial value instead)"));e*=c;c=1;n=M(a,k.ns_ttp,"tickRate");null===n?null!==d&&(c=e):(n=/(\d+)/.exec(n),null!==n?c=parseInt(n[1]):L(b,"Malformed tick rate attribute (using initial value instead)"));
this.effectiveFrameRate=e;this.tickRate=c;n=M(a,k.ns_ittp,"aspectRatio");null===n&&(n=M(a,k.ns_ttp,"displayAspectRatio"));d=null;null!==n&&(e=/(\d+)\s+(\d+)/.exec(n),null!==e?(n=parseInt(e[1]),e=parseInt(e[2]),0!==n&&0!==e?d=n/e:J(b,"Illegal aspectRatio values (ignoring)")):J(b,"Malformed aspectRatio attribute (ignoring)"));this.aspectRatio=d;d=M(a,k.ns_ttp,"timeBase");null!==d&&"media"!==d&&D(b,"Unsupported time base");a=aa(a,b);null===a?this.pxLength={h:null,w:null}:("px"===a.h.unit&&"px"===a.w.unit||
D(b,"Extent on TT must be in px or absent"),this.pxLength={h:new u.ComputedLength(0,1/a.h.value),w:new u.ComputedLength(1/a.w.value,0)});this.dimensions={h:new u.ComputedLength(0,1),w:new u.ComputedLength(1,0)}};h.prototype._registerEvent=function(a){if(!(a.end<=a.begin)){var b=Y(this.events,a.begin);b.found||this.events.splice(b.index,0,a.begin);a.end!==Number.POSITIVE_INFINITY&&(b=Y(this.events,a.end),b.found||this.events.splice(b.index,0,a.end))}};h.prototype.getMediaTimeRange=function(){return[this.events[0],
this.events[this.events.length-1]]};h.prototype.getMediaTimeEvents=function(){return this.events};y.prototype.initFromNode=function(a,b){this.id=V(a);this.styleAttrs=S(a,b);this.styleRefs=H(a)};v.prototype.initFromNode=function(a,b){this.styleAttrs={};for(var e in a.attributes)if(a.attributes[e].uri===k.ns_itts||a.attributes[e].uri===k.ns_ebutts||a.attributes[e].uri===k.ns_tts)this.styleAttrs[a.attributes[e].uri+" "+a.attributes[e].local]=a.attributes[e].value};b.prototype.initFromNode=function(a,
b,d,c){(this.src="src"in d.attributes?d.attributes.src.value:null)||J(c,"Invalid image@src attribute");(this.type="type"in d.attributes?d.attributes.type.value:null)||J(c,"Invalid image@type attribute");n.prototype.initFromNode.call(this,a,b,d,c);m.prototype.initFromNode.call(this,a,b,d,c);C.prototype.initFromNode.call(this,a,b,d,c);e.prototype.initFromNode.call(this,a,b,d,c)};d.prototype.initFromNode=function(a,b,e,d){this.id=V(e)};e.prototype.initFromNode=function(a,b,e,d){this.regionID=e&&"region"in
e.attributes?e.attributes.region.value:""};n.prototype.initFromNode=function(a,b,e,d){this.styleAttrs=S(e,d);null!==a.head&&null!==a.head.styling&&X(a.head.styling,H(e),this.styleAttrs,d)};C.prototype.initFromNode=function(a,b,e,d){this.sets=[]};p.prototype.initFromNode=function(a,b,e,d){this.contents=[]};m.prototype.initFromNode=function(a,b,e,d){b=null;e&&"begin"in e.attributes&&(b=T(a.tickRate,a.effectiveFrameRate,e.attributes.begin.value),null===b&&L(d,"Malformed begin value "+e.attributes.begin.value+
" (using 0)"));var n=null;e&&"dur"in e.attributes&&(n=T(a.tickRate,a.effectiveFrameRate,e.attributes.dur.value),null===n&&L(d,"Malformed dur value "+e.attributes.dur.value+" (ignoring)"));var c=null;e&&"end"in e.attributes&&(c=T(a.tickRate,a.effectiveFrameRate,e.attributes.end.value),null===c&&L(d,"Malformed end value (ignoring)"));this.explicit_begin=b;this.explicit_end=c;this.explicit_dur=n;(a=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null)&&"par"!==a?"seq"===a?d="seq":
(J(d,"Illegal value of timeContainer (assuming 'par')"),d="par"):d="par";this.timeContainer=d};R.prototype.initFromNode=function(a,b,d){n.prototype.initFromNode.call(this,a,null,b,d);m.prototype.initFromNode.call(this,a,null,b,d);C.prototype.initFromNode.call(this,a,null,b,d);e.prototype.initFromNode.call(this,a,null,b,d);p.prototype.initFromNode.call(this,a,null,b,d)};P.prototype.initFromNode=function(a,b,d,c){n.prototype.initFromNode.call(this,a,b,d,c);m.prototype.initFromNode.call(this,a,b,d,c);
C.prototype.initFromNode.call(this,a,b,d,c);e.prototype.initFromNode.call(this,a,b,d,c);p.prototype.initFromNode.call(this,a,b,d,c)};N.prototype.initFromNode=function(a,b,d,c){n.prototype.initFromNode.call(this,a,b,d,c);m.prototype.initFromNode.call(this,a,b,d,c);C.prototype.initFromNode.call(this,a,b,d,c);e.prototype.initFromNode.call(this,a,b,d,c);p.prototype.initFromNode.call(this,a,b,d,c)};z.prototype.initFromNode=function(a,b,d,c,h){n.prototype.initFromNode.call(this,a,b,d,h);m.prototype.initFromNode.call(this,
a,b,d,h);C.prototype.initFromNode.call(this,a,b,d,h);e.prototype.initFromNode.call(this,a,b,d,h);p.prototype.initFromNode.call(this,a,b,d,h);this.space=c};Q.prototype.initFromText=function(a,b,d,e,n){m.prototype.initFromNode.call(this,a,b,null,n);this.text=d;this.space=e};w.prototype.initFromNode=function(a,b,d,n){e.prototype.initFromNode.call(this,a,b,d,n);m.prototype.initFromNode.call(this,a,b,d,n)};K.prototype.createDefaultRegion=function(a,b){var d=new K;d.id="";n.prototype.initFromNode.call(d,
a,null,{name:"region",attributes:{"tts:displayAlign":{name:"tts:displayAlign",value:"after",prefix:"tts",local:"displayAlign",uri:"http://www.w3.org/ns/ttml#styling"},"tts:extent":{name:"tts:extent",value:"80% 20%",prefix:"tts",local:"extent",uri:"http://www.w3.org/ns/ttml#styling"},"tts:origin":{name:"tts:origin",value:"10% 70%",prefix:"tts",local:"origin",uri:"http://www.w3.org/ns/ttml#styling"},"tts:overflow":{name:"tts:overflow",value:"visible",prefix:"tts",local:"overflow",uri:"http://www.w3.org/ns/ttml#styling"}},
ns:{"":"http://www.w3.org/ns/ttml",ebuttm:"urn:ebu:tt:metadata",ebutts:"urn:ebu:tt:style",ittp:"http://www.w3.org/ns/ttml/profile/imsc1#parameter",itts:"http://www.w3.org/ns/ttml/profile/imsc1#styling",ttm:"http://www.w3.org/ns/ttml#metadata",ttp:"http://www.w3.org/ns/ttml#parameter",tts:"http://www.w3.org/ns/ttml#styling",xml:"http://www.w3.org/XML/1998/namespace"},prefix:"",local:"region",uri:"http://www.w3.org/ns/ttml",isSelfClosing:!0},b);d.sets=[];m.call(d,0,Number.POSITIVE_INFINITY,null);return d};
K.prototype.initFromNode=function(a,b,e){d.prototype.initFromNode.call(this,a,null,b,e);m.prototype.initFromNode.call(this,a,null,b,e);C.prototype.initFromNode.call(this,a,null,b,e);this.styleAttrs=S(b,e);this.styleRefs=H(b)};O.prototype.initFromNode=function(a,b,d,e){m.prototype.initFromNode.call(this,a,b,d,e);a=S(d,e);this.value=this.qname=null;for(var n in a){if(this.qname){J(e,"More than one style specified on set");break}this.qname=n;this.value=a[n]}}})("undefined"===typeof u?this.imscDoc={}:
u,"undefined"===typeof sax?g("sax"):sax,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7,sax:void 0}],2:[function(g,v,u){(function(l,g,k){function r(b,d,e){if("region"===e.kind){var n=document.createElement("div");n.style.position="absolute"}else if("body"===e.kind)n=document.createElement("div");else if("div"===e.kind)n=document.createElement("div");
else if("image"===e.kind){if(n=document.createElement("img"),null!==b.imgResolver&&null!==e.src){var f=b.imgResolver(e.src,n);f&&(n.src=f);n.height=b.regionH;n.width=b.regionW}}else if("p"===e.kind)n=document.createElement("p");else if("span"===e.kind)if("container"===e.styleAttrs[k.byName.ruby.qname])n=document.createElement("ruby"),b.ruby=!0;else if("base"===e.styleAttrs[k.byName.ruby.qname])n=document.createElement("rb");else if("text"===e.styleAttrs[k.byName.ruby.qname])n=document.createElement("rt");
else if("baseContainer"===e.styleAttrs[k.byName.ruby.qname])n=document.createElement("rbc");else if("textContainer"===e.styleAttrs[k.byName.ruby.qname])n=document.createElement("rtc");else{if("delimiter"===e.styleAttrs[k.byName.ruby.qname])return;n=document.createElement("span")}else"br"===e.kind&&(n=document.createElement("br"));if(n){d.appendChild(n);n.style.margin="0";if("region"===e.kind)if(d=e.styleAttrs[k.byName.writingMode.qname],"lrtb"===d||"lr"===d)b.ipd="lr",b.bpd="tb";else if("rltb"===
d||"rl"===d)b.ipd="rl",b.bpd="tb";else if("tblr"===d)b.ipd="tb",b.bpd="lr";else{if("tbrl"===d||"tb"===d)b.ipd="tb",b.bpd="rl"}else"p"===e.kind&&"tb"===b.bpd&&(b.ipd="ltr"===e.styleAttrs[k.byName.direction.qname]?"lr":"rl");for(var p in h)d=h[p],f=e.styleAttrs[d.qname],void 0!==f&&null!==d.map&&d.map(b,n,e,f);p=n;(d=e.styleAttrs[k.byName.linePadding.qname])&&!d.isZero()&&(f=d.multiply(d.toUsedLength(b.w,b.h),b.options.sizeAdjust),0<f&&(f=Math.ceil(f)+"px","tb"===b.bpd?(p.style.paddingLeft=f,p.style.paddingRight=
f):(p.style.paddingTop=f,p.style.paddingBottom=f),b.lp=d));(d=e.styleAttrs[k.byName.multiRowAlign.qname])&&"auto"!==d&&(p=document.createElement("span"),p.style.display="inline-block",p.style.textAlign=d,n.appendChild(p),b.mra=d);(d=e.styleAttrs[k.byName.rubyReserve.qname])&&"none"!==d[0]&&(b.rubyReserve=d);e.styleAttrs[k.byName.fillLineGap.qname]&&(b.flg=!0);if("span"===e.kind&&e.text)if((d=e.styleAttrs[k.byName.textEmphasis.qname])&&"none"!==d.style&&(b.textEmphasis=!0),k.byName.textCombine.qname in
e.styleAttrs&&"all"===e.styleAttrs[k.byName.textCombine.qname][0])n.textContent=e.text,d&&c(b,n,e,d);else{f="";for(var m=0;m<e.text.length;m++){f+=e.text.charAt(m);var l=e.text.charCodeAt(m);if(55296>l||56319<l||m===e.text.length)l=document.createElement("span"),l.textContent=f,d&&c(b,l,e,d),n.appendChild(l),f=""}}for(var g in e.contents)r(b,p,e.contents[g]);g=[];if((b.lp||b.mra||b.flg||b.ruby||b.textEmphasis||b.rubyReserve)&&"p"===e.kind){a(b,p,g,null);if(b.rubyReserve){for(d=0;d<g.length;d++){f=
document.createElement("ruby");m=document.createElement("rb");m.textContent="\u200b";f.appendChild(m);var A=b.rubyReserve[1].toUsedLength(b.w,b.h)+"px";"both"===b.rubyReserve[0]||"outside"===b.rubyReserve[0]&&1==g.length?(m=document.createElement("rtc"),m.style[y]=t?"after":"under",m.textContent="\u200b",m.style.fontSize=A,l=document.createElement("rtc"),l.style[y]=t?"before":"over",l.textContent="\u200b",l.style.fontSize=A,f.appendChild(m),f.appendChild(l)):(m=document.createElement("rtc"),m.textContent=
"\u200b",m.style.fontSize=A,m.style[y]="after"===b.rubyReserve[0]||"outside"===b.rubyReserve[0]&&0<d?t?"after":"tb"===b.bpd||"rl"===b.bpd?"under":"over":t?"before":"tb"===b.bpd||"rl"===b.bpd?"over":"under",f.appendChild(m));m=null;for(l=0;l<g[d].rbc.length;l++)if("ruby"===g[d].rbc[l].localName){m=g[d].rbc[l];for(l=0;l<m.style.length;l++)f.style.setProperty(m.style.item(l),m.style.getPropertyValue(m.style.item(l)));break}m=m||g[d].elements[0].node;m.parentElement.insertBefore(f,m)}b.rubyReserve=null}if(b.ruby||
b.rubyReserve){for(d=0;d<g.length;d++)for(f=0;f<g[d].rbc.length;f++)g[d].rbc[f].style[y]||(g[d].rbc[f].style[y]=t?0===d?"before":"after":"tb"===b.bpd?0===d?"over":"under":"rl"===b.bpd?0===d?"over":"under":0===d?"under":"over");b.ruby=null}if(b.textEmphasis){for(d=0;d<g.length;d++)for(f=0;f<g[d].te.length;f++)g[d].te[f].style[B]&&"none"!==g[d].te[f].style[B]||(g[d].te[f].style[B]="tb"===b.bpd?0===d?"left over":"left under":"rl"===b.bpd?0===d?"right under":"left under":0===d?"left under":"right under");
b.textEmphasis=null}if(b.mra){for(d=0;d<g.length-1;d++)m=g[d].elements.length,0!==m&&!1===g[d].br&&(f=document.createElement("br"),m=g[d].elements[m-1].node,m.parentElement.insertBefore(f,m.nextSibling));b.mra=null}if(b.lp){d=b.lp.multiply(b.lp.toUsedLength(b.w,b.h),b.options.sizeAdjust);for(var z in g)f=g[z].elements[g[z].start_elem],m=g[z].elements[g[z].end_elem],l=Math.ceil(d)+"px",A="-"+Math.ceil(d)+"px",0!==g[z].elements.length&&("lr"===b.ipd?(f.node.style.borderLeftColor=f.bgcolor||"#00000000",
f.node.style.borderLeftStyle="solid",f.node.style.borderLeftWidth=l,f.node.style.marginLeft=A):"rl"===b.ipd?(f.node.style.borderRightColor=f.bgcolor||"#00000000",f.node.style.borderRightStyle="solid",f.node.style.borderRightWidth=l,f.node.style.marginRight=A):"tb"===b.ipd&&(f.node.style.borderTopColor=f.bgcolor||"#00000000",f.node.style.borderTopStyle="solid",f.node.style.borderTopWidth=l,f.node.style.marginTop=A),"lr"===b.ipd?(m.node.style.borderRightColor=m.bgcolor||"#00000000",m.node.style.borderRightStyle=
"solid",m.node.style.borderRightWidth=l,m.node.style.marginRight=A):"rl"===b.ipd?(m.node.style.borderLeftColor=m.bgcolor||"#00000000",m.node.style.borderLeftStyle="solid",m.node.style.borderLeftWidth=l,m.node.style.marginLeft=A):"tb"===b.ipd&&(m.node.style.borderBottomColor=m.bgcolor||"#00000000",m.node.style.borderBottomStyle="solid",m.node.style.borderBottomWidth=l,m.node.style.marginBottom=A));b.lp=null}if(b.flg){d=u(p.getBoundingClientRect(),b);z=d.before;d=d.after;f=Math.sign(d-z);for(m=0;m<=
g.length;m++){l=0===m?z:m===g.length?d:(g[m].before+g[m-1].after)/2;if(0<m)for(var v=0;v<g[m-1].elements.length;v++)if(null!==g[m-1].elements[v].bgcolor){var w=g[m-1].elements[v];0>f*(w.after-l)&&(A=Math.ceil(Math.abs(l-w.after))+"px",w.node.style.backgroundColor=w.bgcolor,"lr"===b.bpd?w.node.style.paddingRight=A:"rl"===b.bpd?w.node.style.paddingLeft=A:"tb"===b.bpd&&(w.node.style.paddingBottom=A))}if(m<g.length)for(v=0;v<g[m].elements.length;v++)w=g[m].elements[v],null!==w.bgcolor&&0<f*(w.before-
l)&&(A=Math.ceil(Math.abs(w.before-l))+"px",w.node.style.backgroundColor=w.bgcolor,"lr"===b.bpd?w.node.style.paddingLeft=A:"rl"===b.bpd?w.node.style.paddingRight=A:"tb"===b.bpd&&(w.node.style.paddingTop=A))}b.flg=null}}"region"===e.kind&&(a(b,p,g),"tb"===b.bpd&&b.enableRollUp&&0<e.contents.length&&"after"===e.styleAttrs[k.byName.displayAlign.qname]&&(e=new F(""===e.id?"_":e.id,g),b.currentISDState[e.id]=e,b.previousISDState&&e.id in b.previousISDState&&0<b.previousISDState[e.id].plist.length&&1<e.plist.length&&
e.plist[e.plist.length-2].text===b.previousISDState[e.id].plist[b.previousISDState[e.id].plist.length-1].text&&(b=n.firstElementChild,e=e.plist[e.plist.length-1].after-e.plist[e.plist.length-1].before,b.style.bottom="-"+e+"px",b.style.transition="transform 0.4s",b.style.position="relative",b.style.transform="translateY(-"+e+"px)")))}else if(b=b.errorHandler,e="Error processing ISD element kind: "+e.kind,b&&b.error&&b.error(e))throw e;}function F(a,d){this.id=a;this.plist=d}function u(a,d){var b={before:null,
after:null,start:null,end:null};"tb"===d.bpd?(b.before=a.top,b.after=a.bottom,"lr"===d.ipd?(b.start=a.left,b.end=a.right):(b.start=a.right,b.end=a.left)):"lr"===d.bpd?(b.before=a.left,b.after=a.right,b.start=a.top,b.end=a.bottom):"rl"===d.bpd&&(b.before=a.right,b.after=a.left,b.start=a.top,b.end=a.bottom);return b}function a(b,d,e,n){if("rt"!==d.localName&&"rtc"!==d.localName)if(n=d.style.backgroundColor||n,0===d.childElementCount)if("span"===d.localName||"rb"===d.localName){var c=d.getBoundingClientRect();
if(0!==c.height&&0!==c.width){b=u(c,b);if(!(c=0===e.length)){c=b.before;var f=b.after,h=e[e.length-1].before,k=e[e.length-1].after;c=!(f<k&&c>h||k<=f&&h>=c)}c?e.push({before:b.before,after:b.after,start:b.start,end:b.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1}):(c=Math.sign(b.after-b.before),f=Math.sign(b.end-b.start),0>c*(b.before-e[e.length-1].before)&&(e[e.length-1].before=b.before),0<c*(b.after-e[e.length-1].after)&&(e[e.length-1].after=b.after),0>f*(b.start-e[e.length-
1].start)&&(e[e.length-1].start=b.start,e[e.length-1].start_elem=e[e.length-1].elements.length),0<f*(b.end-e[e.length-1].end)&&(e[e.length-1].end=b.end,e[e.length-1].end_elem=e[e.length-1].elements.length));e[e.length-1].text+=d.textContent;e[e.length-1].elements.push({node:d,bgcolor:n,before:b.before,after:b.after})}}else"br"===d.localName&&0!==e.length&&(e[e.length-1].br=!0);else for(d=d.firstChild;d;)d.nodeType===Node.ELEMENT_NODE&&(a(b,d,e,n),"ruby"===d.localName||"rtc"===d.localName?0<e.length&&
e[e.length-1].rbc.push(d):"span"===d.localName&&d.style[v]&&"none"!==d.style[v]&&0<e.length&&e[e.length-1].te.push(d)),d=d.nextSibling}function c(a,d,e,n){if("none"===n.style)d.style[v]="none";else if(d.style[v]="auto"===n.style?"filled":n.style+" "+n.symbol,"before"===n.position||"after"===n.position)d.style[B]="tb"===a.bpd?"before"===n.position?"left over":"left under":"rl"===a.bpd?"before"===n.position?"right under":"left under":"before"===n.position?"left under":"right under"}function f(a,d){this.qname=
a;this.map=d}l.render=function(a,d,e,n,c,f,h,k,l,t){n=n||d.clientHeight;c=c||d.clientWidth;if(null!==a.aspectRatio){var b=n*a.aspectRatio;b>c?n=Math.round(c/a.aspectRatio):c=b}b=document.createElement("div");b.style.position="relative";b.style.width=c+"px";b.style.height=n+"px";b.style.margin="auto";b.style.top=0;b.style.bottom=0;b.style.left=0;b.style.right=0;b.style.zIndex=0;e={h:n,w:c,regionH:null,regionW:null,imgResolver:e,displayForcedOnlyMode:f||!1,isd:a,errorHandler:h,previousISDState:k,enableRollUp:l||
!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null,options:t?t:{}};d.appendChild(b);for(var m in a.contents)r(e,b,a.contents[m]);return e.currentISDState};var h=[new f("http://www.w3.org/ns/ttml#styling backgroundColor",function(a,d,e,c){0!==c[3]&&(d.style.backgroundColor="rgba("+c[0].toString()+","+c[1].toString()+","+c[2].toString()+","+(c[3]/255).toString()+")")}),new f("http://www.w3.org/ns/ttml#styling color",function(a,d,e,c){d.style.color=
"rgba("+c[0].toString()+","+c[1].toString()+","+c[2].toString()+","+(c[3]/255).toString()+")"}),new f("http://www.w3.org/ns/ttml#styling direction",function(a,d,e,c){d.style.direction=c}),new f("http://www.w3.org/ns/ttml#styling display",function(a,d,e,c){}),new f("http://www.w3.org/ns/ttml#styling displayAlign",function(a,d,e,c){d.style.display="flex";d.style.flexDirection="column";"before"===c?d.style.justifyContent="flex-start":"center"===c?d.style.justifyContent="center":"after"===c&&(d.style.justifyContent=
"flex-end")}),new f("http://www.w3.org/ns/ttml#styling extent",function(a,d,e,c){a.regionH=c.h.toUsedLength(a.w,a.h);a.regionW=c.w.toUsedLength(a.w,a.h);var b=c=0;if(e=e.styleAttrs["http://www.w3.org/ns/ttml#styling padding"])c=e[0].toUsedLength(a.w,a.h)+e[2].toUsedLength(a.w,a.h),b=e[1].toUsedLength(a.w,a.h)+e[3].toUsedLength(a.w,a.h);d.style.height=a.regionH-c+"px";d.style.width=a.regionW-b+"px"}),new f("http://www.w3.org/ns/ttml#styling fontFamily",function(a,d,e,c){a=[];for(var b in c)c[b]=c[b].trim(),
"monospaceSerif"===c[b]?(a.push("Courier New"),a.push('"Liberation Mono"'),a.push("Courier"),a.push("monospace")):"proportionalSansSerif"===c[b]||"default"===c[b]?(a.push("Arial"),a.push("Helvetica"),a.push('"Liberation Sans"'),a.push("sans-serif")):"monospace"===c[b]?a.push("monospace"):"sansSerif"===c[b]?a.push("sans-serif"):"serif"===c[b]?a.push("serif"):"monospaceSansSerif"===c[b]?(a.push("Consolas"),a.push("monospace")):"proportionalSerif"===c[b]?a.push("serif"):a.push(c[b]);d.style.fontFamily=
a.join(",")}),new f("http://www.w3.org/ns/ttml#styling shear",function(a,d,e,c){0!==c&&(e=-.9*c,d.style.transform="tb"===a.bpd?"skewX("+e+"deg)":"skewY("+e+"deg)")}),new f("http://www.w3.org/ns/ttml#styling fontSize",function(a,d,e,c){d.style.fontSize=c.multiply(c.toUsedLength(a.w,a.h),a.options.sizeAdjust)+"px"}),new f("http://www.w3.org/ns/ttml#styling fontStyle",function(a,d,e,c){d.style.fontStyle=c}),new f("http://www.w3.org/ns/ttml#styling fontWeight",function(a,d,e,c){d.style.fontWeight=c}),
new f("http://www.w3.org/ns/ttml#styling lineHeight",function(a,d,e,c){d.style.lineHeight="normal"===c?"normal":c.multiply(c.toUsedLength(a.w,a.h),a.options.sizeAdjust)+"px"}),new f("http://www.w3.org/ns/ttml#styling opacity",function(a,d,e,c){d.style.opacity=c}),new f("http://www.w3.org/ns/ttml#styling origin",function(a,d,e,c){d.style.top=c.h.toUsedLength(a.w,a.h)+"px";d.style.left=c.w.toUsedLength(a.w,a.h)+"px"}),new f("http://www.w3.org/ns/ttml#styling overflow",function(a,d,e,c){d.style.overflow=
c}),new f("http://www.w3.org/ns/ttml#styling padding",function(a,d,e,c){e=[];e[0]=c[0].toUsedLength(a.w,a.h)+"px";e[1]=c[3].toUsedLength(a.w,a.h)+"px";e[2]=c[2].toUsedLength(a.w,a.h)+"px";e[3]=c[1].toUsedLength(a.w,a.h)+"px";d.style.padding=e.join(" ")}),new f("http://www.w3.org/ns/ttml#styling position",function(a,d,e,c){d.style.top=c.h.toUsedLength(a.w,a.h)+"px";d.style.left=c.w.toUsedLength(a.w,a.h)+"px"}),new f("http://www.w3.org/ns/ttml#styling rubyAlign",function(a,d,e,c){d.style.rubyAlign=
"spaceAround"===c?"space-around":"center"}),new f("http://www.w3.org/ns/ttml#styling rubyPosition",function(a,d,e,c){if("before"===c||"after"===c)d.parentElement.style[y]=t?c:"tb"===a.bpd?"before"===c?"over":"under":"rl"===a.bpd?"before"===c?"over":"under":"before"===c?"under":"over"}),new f("http://www.w3.org/ns/ttml#styling showBackground",null),new f("http://www.w3.org/ns/ttml#styling textAlign",function(a,d,e,c){d.style.textAlign="start"===c?"rl"===a.ipd?"right":"left":"end"===c?"rl"===a.ipd?
"left":"right":c}),new f("http://www.w3.org/ns/ttml#styling textDecoration",function(a,d,e,c){d.style.textDecoration=c.join(" ").replace("lineThrough","line-through")}),new f("http://www.w3.org/ns/ttml#styling textOutline",function(a,d,e,c){}),new f("http://www.w3.org/ns/ttml#styling textShadow",function(a,d,e,c){var b=e.styleAttrs[k.byName.textOutline.qname];if("none"===c&&"none"===b)d.style.textShadow="";else{e=[];"none"!==b&&(b="rgba("+b.color[0].toString()+","+b.color[1].toString()+","+b.color[2].toString()+
","+(b.color[3]/255).toString()+")",e.push("1px 1px 1px "+b),e.push("-1px 1px 1px "+b),e.push("1px -1px 1px "+b),e.push("-1px -1px 1px "+b));if("none"!==c)for(var f in c)e.push(c[f].x_off.toUsedLength(a.w,a.h)+"px "+c[f].y_off.toUsedLength(a.w,a.h)+"px "+c[f].b_radius.toUsedLength(a.w,a.h)+"px rgba("+c[f].color[0].toString()+","+c[f].color[1].toString()+","+c[f].color[2].toString()+","+(c[f].color[3]/255).toString()+")");d.style.textShadow=e.join(",")}}),new f("http://www.w3.org/ns/ttml#styling textCombine",
function(a,d,c,f){d.style.textCombineUpright=f.join(" ")}),new f("http://www.w3.org/ns/ttml#styling textEmphasis",function(a,d,c,f){}),new f("http://www.w3.org/ns/ttml#styling unicodeBidi",function(a,d,c,f){d.style.unicodeBidi="bidiOverride"===f?"bidi-override":f}),new f("http://www.w3.org/ns/ttml#styling visibility",function(a,d,c,f){d.style.visibility=f}),new f("http://www.w3.org/ns/ttml#styling wrapOption",function(a,d,c,f){d.style.whiteSpace="wrap"===f?"preserve"===c.space?"pre-wrap":"normal":
"preserve"===c.space?"pre":"noWrap"}),new f("http://www.w3.org/ns/ttml#styling writingMode",function(a,d,c,f){if("lrtb"===f||"lr"===f)d.style.writingMode="horizontal-tb";else if("rltb"===f||"rl"===f)d.style.writingMode="horizontal-tb";else if("tblr"===f)d.style.writingMode="vertical-lr";else if("tbrl"===f||"tb"===f)d.style.writingMode="vertical-rl"}),new f("http://www.w3.org/ns/ttml#styling zIndex",function(a,d,c,f){d.style.zIndex=f}),new f("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",
function(a,d,c,f){a.displayForcedOnlyMode&&!1===f&&(d.style.visibility="hidden")})],A;for(A in h);var t="webkitRubyPosition"in window.getComputedStyle(document.documentElement),y=t?"webkitRubyPosition":"rubyPosition",v="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",B="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition"})("undefined"===typeof u?
this.imscHTML={}:u,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],3:[function(g,v,u){(function(l,g,k,r){function F(f,l,g,v,b,d,e,n,C){if(l<e.begin||l>=e.end)return null;d="regionID"in e&&""!==e.regionID?e.regionID:d;if(null!==b&&d!==g.id&&(!("contents"in e)||"contents"in e&&0===e.contents.length||""!==d))return null;var p=new h(e);for(m in e.sets)l<
e.sets[m].begin||l>=e.sets[m].end||(p.styleAttrs[e.sets[m].qname]=e.sets[m].value);var m={};for(var t in p.styleAttrs)if(m[t]=!0,"region"===p.kind&&t===k.byName.writingMode.qname&&!(k.byName.direction.qname in p.styleAttrs)){var y=p.styleAttrs[t];if("lrtb"===y||"lr"===y)p.styleAttrs[k.byName.direction.qname]="ltr";else if("rltb"===y||"rl"===y)p.styleAttrs[k.byName.direction.qname]="rtl"}if(null!==b)for(var B in k.all)if(t=k.all[B],t.qname===k.byName.textDecoration.qname){y=b.styleAttrs[t.qname];var z=
p.styleAttrs[t.qname],G=[];void 0===z?G=y:-1===z.indexOf("none")?((-1===z.indexOf("noUnderline")&&-1!==y.indexOf("underline")||-1!==z.indexOf("underline"))&&G.push("underline"),(-1===z.indexOf("noLineThrough")&&-1!==y.indexOf("lineThrough")||-1!==z.indexOf("lineThrough"))&&G.push("lineThrough"),(-1===z.indexOf("noOverline")&&-1!==y.indexOf("overline")||-1!==z.indexOf("overline"))&&G.push("overline")):G.push("none");p.styleAttrs[t.qname]=G}else t.qname!==k.byName.fontSize.qname||t.qname in p.styleAttrs||
"span"!==p.kind||"textContainer"!==p.styleAttrs[k.byName.ruby.qname]?t.qname!==k.byName.fontSize.qname||t.qname in p.styleAttrs||"span"!==p.kind||"text"!==p.styleAttrs[k.byName.ruby.qname]?t.inherit&&t.qname in b.styleAttrs&&!(t.qname in p.styleAttrs)&&(p.styleAttrs[t.qname]=b.styleAttrs[t.qname]):(y=b.styleAttrs[k.byName.fontSize.qname],p.styleAttrs[t.qname]="textContainer"===b.styleAttrs[k.byName.ruby.qname]?y:new r.ComputedLength(.5*y.rw,.5*y.rh)):(y=b.styleAttrs[k.byName.fontSize.qname],p.styleAttrs[t.qname]=
new r.ComputedLength(.5*y.rw,.5*y.rh));for(var w in k.all)if(B=k.all[w],!(B.qname in p.styleAttrs||B.qname===k.byName.position.qname&&k.byName.origin.qname in p.styleAttrs||B.qname===k.byName.origin.qname&&k.byName.position.qname in p.styleAttrs)&&(t=f.head.styling.initials[B.qname]||B.initial,null!==t&&("region"===p.kind||!1===B.inherit&&null!==t)))if(t=B.parse(t),null!==t)p.styleAttrs[B.qname]=t,m[B.qname]=!0;else if(B="Invalid initial value for '"+B.qname+"' on element '"+p.kind,n&&n.error&&n.error(B))throw B;
for(var K in k.all)if(w=k.all[K],w.qname in m&&null!==w.compute)if(B=w.compute(f,b,p,p.styleAttrs[w.qname],C),null!==B)p.styleAttrs[w.qname]=B;else if(p.styleAttrs[w.qname]=w.compute(f,b,p,w.parse(w.initial),C),w="Style '"+w.qname+"' on element '"+p.kind+"' cannot be computed",n&&n.error&&n.error(w))throw w;if("none"===p.styleAttrs[k.byName.display.qname])return null;if(null===b)var O=null===v?[]:[v];else"contents"in e&&(O=e.contents);for(var Z in O)b=F(f,l,g,v,p,d,O[Z],n,C),null!==b&&p.contents.push(b.element);
for(var H in p.styleAttrs)f=!1,"span"===p.kind&&(l=p.styleAttrs[k.byName.ruby.qname],(f=("container"===l||"textContainer"===l||"baseContainer"===l)&&-1!==A.indexOf(H))||(f="container"!==l&&H===k.byName.rubyAlign.qname),f||(f=!("textContainer"===l||"text"===l)&&H===k.byName.rubyPosition.qname)),f||(f=-1===k.byQName[H].applies.indexOf(p.kind)),f&&delete p.styleAttrs[H];H=p.styleAttrs[k.byName.ruby.qname];if("p"===p.kind||"span"===p.kind&&("textContainer"===H||"text"===H))H=[],a(p,H),u(H),c(p);return"div"===
p.kind&&k.byName.backgroundImage.qname in p.styleAttrs||"br"===p.kind||"image"===p.kind||"contents"in p&&0<p.contents.length||"span"===p.kind&&null!==p.text||"region"===p.kind&&"always"===p.styleAttrs[k.byName.showBackground.qname]?{region_id:d,element:p}:null}function u(a){function c(a){return"br"===a.kind||/[\r\n\t ]$/.test(a.text)}function f(a){return"br"===a.kind||"preserve"===a.space&&/^[\r\n]/.test(a.text)}for(var h,b=0;b<a.length;)if(h=a[b],"br"===h.kind||"preserve"===h.space)b++;else{var d=
h.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(d)&&(0===b||c(a[b-1]))&&(d=d.substring(1));h.text=d;0===d.length?a.splice(b,1):b++}for(b=0;b<a.length;b++)h=a[b],"br"===h.kind||"preserve"===h.space?b++:/[ ]$/.test(h.text)&&(b===a.length-1||f(a[b+1]))&&(h.text=h.text.slice(0,-1))}function a(c,f){for(var h in c.contents){var l=c.contents[h],b=l.styleAttrs[k.byName.ruby.qname];if("span"!==l.kind||"textContainer"!==b&&"text"!==b)"contents"in l?a(l,f):("span"===l.kind&&0!==l.text.length||"br"===l.kind)&&
f.push(l)}}function c(a){if("br"===a.kind)return!1;if("text"in a)return 0===a.text.length;if("contents"in a){for(var f=a.contents.length;f--;)c(a.contents[f])&&a.contents.splice(f,1);return 0===a.contents.length}}function f(a){this.contents=[];this.aspectRatio=a.aspectRatio}function h(a){this.kind=a.kind||"region";a.id&&(this.id=a.id);this.styleAttrs={};for(var c in a.styleAttrs)this.styleAttrs[c]=a.styleAttrs[c];"src"in a&&(this.src=a.src);"type"in a&&(this.type=a.type);if("text"in a)this.text=a.text;
else if("region"===this.kind||"contents"in a)this.contents=[];"space"in a&&(this.space=a.space)}l.generateISD=function(a,c,h){var l=new f(a),b={},d;for(d in a.head.layout.regions){var e=F(a,c,a.head.layout.regions[d],a.body,null,"",a.head.layout.regions[d],h,b);null!==e&&l.contents.push(e.element)}return l};var A=[k.byName.color.qname,k.byName.textCombine.qname,k.byName.textDecoration.qname,k.byName.textEmphasis.qname,k.byName.textOutline.qname,k.byName.textShadow.qname]})("undefined"===typeof u?
this.imscISD={}:u,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscStyles?g("./styles"):imscStyles,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],4:[function(g,v,u){u.generateISD=g("./isd").generateISD;u.fromXML=g("./doc").fromXML;u.renderHTML=g("./html").render},{"./doc":1,"./html":2,"./isd":3}],5:[function(g,v,u){g="undefined"===typeof u?this.imscNames={}:u;g.ns_tt="http://www.w3.org/ns/ttml";g.ns_tts="http://www.w3.org/ns/ttml#styling";
g.ns_ttp="http://www.w3.org/ns/ttml#parameter";g.ns_xml="http://www.w3.org/XML/1998/namespace";g.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling";g.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter";g.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt";g.ns_ebutts="urn:ebu:tt:style";g.ttaf_map={"http://www.w3.org/2006/10/ttaf1":g.ns_tt,"http://www.w3.org/2006/10/ttaf1#style":g.ns_tts,"http://www.w3.org/2006/10/ttaf1#parameter":g.ns_ttp}},{}],6:[function(g,v,u){(function(l,
g,k){function r(a,c,f,h,g,l,k,r){this.name=c;this.ns=a;this.qname=a+" "+c;this.inherit=g;this.animatable=l;this.initial=f;this.applies=h;this.parse=k;this.compute=r}l.all=[new r(g.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,k.parseColor,null),new r(g.ns_tts,"color","white",["span"],!0,!0,k.parseColor,null),new r(g.ns_tts,"direction","ltr",["p","span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(a){return a},
null),new r(g.ns_tts,"displayAlign","before",["region"],!1,!0,function(a){return a},null),new r(g.ns_tts,"extent","auto",["tt","region"],!1,!0,function(a){if("auto"===a)return a;var c=a.split(" ");if(2!==c.length)return null;a=k.parseLength(c[0]);return(c=k.parseLength(c[1]))&&a?{h:c,w:a}:null},function(a,c,f,h,g){if("auto"===h)c=new k.ComputedLength(0,1);else if(c=k.toComputedLength(h.h.value,h.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===c)return null;if("auto"===h)a=new k.ComputedLength(1,
0);else if(a=k.toComputedLength(h.w.value,h.w.unit,null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:c,w:a}}),new r(g.ns_tts,"fontFamily","default",["span"],!0,!0,function(a){a=a.split(",");var c=[],f;for(f in a)"'"!==a[f].charAt(0)&&'"'!==a[f].charAt(0)?"default"===a[f]?c.push("monospaceSerif"):c.push(a[f]):c.push(a[f]);return c},null),new r(g.ns_tts,"shear","0%",["p"],!0,!0,k.parseLength,function(a,c,f,h){if("%"===h.unit)a=100<Math.abs(h.value)?100*Math.sign(h.value):h.value;
else return null;return a}),new r(g.ns_tts,"fontSize","1c",["span"],!0,!0,k.parseLength,function(a,c,f,h,g){return k.toComputedLength(h.value,h.unit,null!==c?c.styleAttrs[l.byName.fontSize.qname]:a.cellLength.h,null!==c?c.styleAttrs[l.byName.fontSize.qname]:a.cellLength.h,a.cellLength.h,a.pxLength.h)}),new r(g.ns_tts,"fontStyle","normal",["span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"fontWeight","normal",["span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"lineHeight","normal",["p"],
!0,!0,function(a){return"normal"===a?a:k.parseLength(a)},function(a,c,f,h,g){if("normal"===h)a=h;else if(a=k.toComputedLength(h.value,h.unit,f.styleAttrs[l.byName.fontSize.qname],f.styleAttrs[l.byName.fontSize.qname],a.cellLength.h,a.pxLength.h),null===a)return null;return a}),new r(g.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(g.ns_tts,"origin","auto",["region"],!1,!0,function(a){if("auto"===a)return a;var c=a.split(" ");if(2!==c.length)return null;a=k.parseLength(c[0]);return(c=k.parseLength(c[1]))&&
a?{h:c,w:a}:null},function(a,c,f,h,g){if("auto"===h)c=new k.ComputedLength(0,0);else if(c=k.toComputedLength(h.h.value,h.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===c)return null;if("auto"===h)a=new k.ComputedLength(0,0);else if(a=k.toComputedLength(h.w.value,h.w.unit,null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:c,w:a}}),new r(g.ns_tts,"overflow","hidden",["region"],!1,!0,function(a){return a},null),new r(g.ns_tts,"padding","0px",["region"],!1,!0,function(a){a=a.split(" ");
if(4<a.length)return null;var c=[],f;for(f in a){var h=k.parseLength(a[f]);if(!h)return null;c.push(h)}return c},function(a,c,f,h,g){if(1===h.length)c=[h[0],h[0],h[0],h[0]];else if(2===h.length)c=[h[0],h[1],h[0],h[1]];else if(3===h.length)c=[h[0],h[1],h[2],h[1]];else if(4===h.length)c=[h[0],h[1],h[2],h[3]];else return null;h=f.styleAttrs[l.byName.writingMode.qname];if("lrtb"===h||"lr"===h)c=[c[0],c[3],c[2],c[1]];else if("rltb"===h||"rl"===h)c=[c[0],c[1],c[2],c[3]];else if("tblr"===h)c=[c[3],c[0],
c[1],c[2]];else if("tbrl"===h||"tb"===h)c=[c[3],c[2],c[1],c[0]];else return null;h=[];for(var t in c)if(0===c[t].value)h[t]=new k.ComputedLength(0,0);else if(h[t]=k.toComputedLength(c[t].value,c[t].unit,f.styleAttrs[l.byName.fontSize.qname],"0"===t||"2"===t?f.styleAttrs[l.byName.extent.qname].h:f.styleAttrs[l.byName.extent.qname].w,"0"===t||"2"===t?a.cellLength.h:a.cellLength.w,"0"===t||"2"===t?a.pxLength.h:a.pxLength.w),null===h[t])return null;return h}),new r(g.ns_tts,"position","top left",["region"],
!1,!0,function(a){return k.parsePosition(a)},function(a,c,f,h){c=k.toComputedLength(h.v.offset.value,h.v.offset.unit,null,new k.ComputedLength(-f.styleAttrs[l.byName.extent.qname].h.rw,a.dimensions.h.rh-f.styleAttrs[l.byName.extent.qname].h.rh),null,a.pxLength.h);if(null===c)return null;"bottom"===h.v.edge&&(c=new k.ComputedLength(-c.rw-f.styleAttrs[l.byName.extent.qname].h.rw,a.dimensions.h.rh-c.rh-f.styleAttrs[l.byName.extent.qname].h.rh));var g=k.toComputedLength(h.h.offset.value,h.h.offset.unit,
null,new k.ComputedLength(a.dimensions.w.rw-f.styleAttrs[l.byName.extent.qname].w.rw,-f.styleAttrs[l.byName.extent.qname].w.rh),null,a.pxLength.w);if(null===c)return null;"right"===h.h.edge&&(g=new k.ComputedLength(a.dimensions.w.rw-g.rw-f.styleAttrs[l.byName.extent.qname].w.rw,-g.rh-f.styleAttrs[l.byName.extent.qname].w.rh));return{h:c,w:g}}),new r(g.ns_tts,"ruby","none",["span"],!1,!0,function(a){return a},null),new r(g.ns_tts,"rubyAlign","center",["span"],!0,!0,function(a){return"center"!==a&&
"spaceAround"!==a?null:a},null),new r(g.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"rubyReserve","none",["p"],!0,!0,function(a){var c=a.split(" ");a=[null,null];if(0===c.length||2<c.length||"none"!==c[0]&&"both"!==c[0]&&"after"!==c[0]&&"before"!==c[0]&&"outside"!==c[0])return null;a[0]=c[0];if(2===c.length&&"none"!==c[0])if(c=k.parseLength(c[1]))a[1]=c;else return null;return a},function(a,c,f,h,g){if("none"===h[0])return h;a=null===h[1]?new k.ComputedLength(.5*
f.styleAttrs[l.byName.fontSize.qname].rw,.5*f.styleAttrs[l.byName.fontSize.qname].rh):k.toComputedLength(h[1].value,h[1].unit,f.styleAttrs[l.byName.fontSize.qname],f.styleAttrs[l.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);return null===a?null:[h[0],a]}),new r(g.ns_tts,"showBackground","whenActive",["region"],!1,!0,function(a){return a},null),new r(g.ns_tts,"textAlign","start",["p"],!0,!0,function(a){return a},function(a,c,f,h,g){return"left"===h?"start":"right"===h?"end":h}),new r(g.ns_tts,
"textCombine","none",["span"],!0,!0,function(a){a=a.split(" ");return 1!==a.length||"none"!==a[0]&&"all"!==a[0]?null:[a[0]]},null),new r(g.ns_tts,"textDecoration","none",["span"],!0,!0,function(a){return a.split(" ")},null),new r(g.ns_tts,"textEmphasis","none",["span"],!0,!0,function(a){a=a.split(" ");var c={style:null,symbol:null,color:null,position:null},f;for(f in a)if("none"===a[f]||"auto"===a[f])c.style=a[f];else if("filled"===a[f]||"open"===a[f])c.style=a[f];else if("circle"===a[f]||"dot"===
a[f]||"sesame"===a[f])c.symbol=a[f];else if("current"===a[f])c.color=a[f];else if("outside"===a[f]||"before"===a[f]||"after"===a[f])c.position=a[f];else if(c.color=k.parseColor(a[f]),null===c.color)return null;null==c.style&&null==c.symbol?c.style="auto":(c.symbol=c.symbol||"circle",c.style=c.style||"filled");c.position=c.position||"outside";c.color=c.color||"current";return c},null),new r(g.ns_tts,"textOutline","none",["span"],!0,!0,function(a){if("none"===a)return a;var c={};a=a.split(" ");if(0===
a.length||2<a.length)return null;var f=k.parseColor(a[0]);c.color=f;null!==f&&a.shift();if(1!==a.length)return null;a=k.parseLength(a[0]);if(!a)return null;c.thickness=a;return c},function(a,c,f,h,g){if("none"===h)return h;c={};c.color=null===h.color?f.styleAttrs[l.byName.color.qname]:h.color;c.thickness=k.toComputedLength(h.thickness.value,h.thickness.unit,f.styleAttrs[l.byName.fontSize.qname],f.styleAttrs[l.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);return null===c.thickness?null:c}),new r(g.ns_tts,
"textShadow","none",["span"],!0,!0,k.parseTextShadow,function(a,c,f,h){if("none"===h)return h;c=[];for(var g in h){var t={};t.x_off=k.toComputedLength(h[g][0].value,h[g][0].unit,null,f.styleAttrs[l.byName.fontSize.qname],null,a.pxLength.w);if(null===t.x_off)return null;t.y_off=k.toComputedLength(h[g][1].value,h[g][1].unit,null,f.styleAttrs[l.byName.fontSize.qname],null,a.pxLength.h);if(null===t.y_off)return null;if(null===h[g][2])t.b_radius=0;else if(t.b_radius=k.toComputedLength(h[g][2].value,h[g][2].unit,
null,f.styleAttrs[l.byName.fontSize.qname],null,a.pxLength.h),null===t.b_radius)return null;t.color=null===h[g][3]?f.styleAttrs[l.byName.color.qname]:h[g][3];c.push(t)}return c}),new r(g.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(a){return a},null),new r(g.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(a){return a},null),new r(g.ns_tts,"writingMode","lrtb",["region"],!1,!0,
function(a){return a},null),new r(g.ns_tts,"zIndex","auto",["region"],!1,!0,function(a){"auto"!==a&&(a=parseInt(a),isNaN(a)&&(a=null));return a},null),new r(g.ns_ebutts,"linePadding","0c",["p"],!0,!1,k.parseLength,function(a,c,f,h,g){return k.toComputedLength(h.value,h.unit,null,null,a.cellLength.w,null)}),new r(g.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(a){return a},null),new r(g.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(a){return a},null),new r(g.ns_itts,"forcedDisplay",
"false",["body","div","p","region","span"],!0,!0,function(a){return"true"===a?!0:!1},null),new r(g.ns_itts,"fillLineGap","true",["p"],!0,!0,function(a){return"true"===a?!0:!1},null)];l.byQName={};for(var u in l.all)l.byQName[l.all[u].qname]=l.all[u];l.byName={};for(var v in l.all)l.byName[l.all[v].name]=l.all[v]})("undefined"===typeof u?this.imscStyles={}:u,"undefined"===typeof imscNames?g("./names"):imscNames,"undefined"===typeof imscUtils?g("./utils"):imscUtils)},{"./names":5,"./utils":7}],7:[function(g,
v,u){(function(g){var l=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,k=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,u={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,
255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};g.parseColor=function(a){var c,f=null,g=u[a.toLowerCase()];void 0!==g?f=g:null!==(c=l.exec(a))?f=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),void 0!==c[4]?parseInt(c[4],16):255]:null!==(c=k.exec(a))?f=[parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),255]:null!==(c=r.exec(a))&&(f=[parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),parseInt(c[4])]);return f};var v=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;
g.parseLength=function(a){var c,f=null;null!==(c=v.exec(a))&&(f={value:parseFloat(c[1]),unit:c[2]});return f};g.parseTextShadow=function(a){a=a.split(",");var c=[],f;for(f in a){var h=a[f].split(" ");if(1===h.length&&"none"===h[0])return"none";if(1<h.length&&5>h.length){var k=[null,null,null,null],l=g.parseLength(h.shift());if(null===l)return null;k[0]=l;l=g.parseLength(h.shift());if(null===l)return null;k[1]=l;if(0!==h.length&&(l=g.parseLength(h[0]),null!==l&&(k[2]=l,h.shift()),0!==h.length)){h=
g.parseColor(h[0]);if(null===h)return null;k[3]=h}c.push(k)}}return c};g.parsePosition=function(a){a=a.split(" ");var c=function(a){return"center"===a||"left"===a||"top"===a||"bottom"===a||"right"===a};if(4<a.length)return null;for(var f in a)if(!c(a[f])){var h=g.parseLength(a[f]);if(null===h)return null;a[f]=h}f={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}};for(h=0;h<a.length;){var k=a[h++];if(c(k)){var l={value:0,unit:"%"};2!==a.length&&h<a.length&&!c(a[h])&&
(l=a[h++]);"right"===k?(f.h.edge=k,f.h.offset=l):"bottom"===k?(f.v.edge=k,f.v.offset=l):"left"===k?f.h.offset=l:"top"===k&&(f.v.offset=l)}else if(1===a.length||2===a.length)1===h?f.h.offset=k:f.v.offset=k;else return null}return f};g.ComputedLength=function(a,c){this.rw=a;this.rh=c};g.ComputedLength.prototype.toUsedLength=function(a,c){return a*this.rw+c*this.rh};g.ComputedLength.prototype.multiply=function(a,c){return c?a*c:a};g.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===
this.rh};g.toComputedLength=function(a,c,f,h,k,l){return"%"===c&&h?new g.ComputedLength(h.rw*a/100,h.rh*a/100):"em"===c&&f?new g.ComputedLength(f.rw*a,f.rh*a):"c"===c&&k?new g.ComputedLength(a*k.rw,a*k.rh):"px"===c&&l?new g.ComputedLength(a*l.rw,a*l.rh):"rh"===c?new g.ComputedLength(0,a/100):"rw"===c?new g.ComputedLength(a/100,0):null}})("undefined"===typeof u?this.imscUtils={}:u)},{}]},{},[4])(4)});
