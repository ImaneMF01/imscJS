var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(f,t){return Object.prototype.hasOwnProperty.call(f,t)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,t,q){f!=Array.prototype&&f!=Object.prototype&&(f[t]=q.value)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,t,q,w){if(t){q=$jscomp.global;f=f.split(".");for(w=0;w<f.length-1;w++){var n=f[w];n in q||(q[n]={});q=q[n]}f=f[f.length-1];w=q[f];t=t(w);t!=w&&null!=t&&$jscomp.defineProperty(q,f,{configurable:!0,writable:!0,value:t})}};
$jscomp.polyfill("Object.entries",function(f){return f?f:function(f){var q=[],w;for(w in f)$jscomp.owns(f,w)&&q.push([w,f[w]]);return q}},"es8","es3");$jscomp.polyfill("Math.sign",function(f){return f?f:function(f){f=Number(f);return 0===f||isNaN(f)?f:0<f?1:-1}},"es6","es3");
(function(f){"object"===typeof exports&&"undefined"!==typeof module?module.exports=f():"function"===typeof define&&define.amd?define([],f):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).imsc=f()})(function(){return function(){function f(t,q,w){function n(l,J){if(!q[l]){if(!t[l]){var a="function"==typeof require&&require;if(!J&&a)return a(l,!0);if(m)return m(l,!0);J=Error("Cannot find module '"+l+"'");throw J.code="MODULE_NOT_FOUND",J;}J=
q[l]={exports:{}};t[l][0].call(J.exports,function(a){return n(t[l][1][a]||a)},J,J.exports,f,t,q,w)}return q[l].exports}for(var m="function"==typeof require&&require,l=0;l<w.length;l++)n(w[l]);return n}return f}()({1:[function(f,t,q){(function(w,f,m,l,q){function n(d,a){var b=d.styleAttrs&&d.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"];if("span"===d.kind)!b&&a&&(d.styleAttrs||(d.styleAttrs={}),d.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"]=a);else if(b&&delete d.styleAttrs["http://www.w3.org/ns/ttml#styling backgroundColor"],
d.contents)for(var h=0;h<d.contents.length;h++)n(d.contents[h],b||a)}function a(d){if("contents"in d){var b="styleAttrs"in d?d.styleAttrs[l.byName.ruby.qname]:null;b="span"===d.kind&&("container"===b||"textContainer"===b||"baseContainer"===b);for(var h=d.contents.length-1;0<=h;h--)!b||"styleAttrs"in d.contents[h]&&l.byName.ruby.qname in d.contents[h].styleAttrs?a(d.contents[h]):delete d.contents[h]}}function e(d,a,b,h){var c=h&&"seq"===h.timeContainer,G=0;h&&(G=c&&b?b.end:h.begin);a.begin=a.explicit_begin?
a.explicit_begin+G:G;b=a.begin;h=null;for(var r in a.sets)e(d,a.sets[r],h,a),b="seq"===a.timeContainer?a.sets[r].end:Math.max(b,a.sets[r].end),h=a.sets[r];if("contents"in a)for(var g in a.contents)e(d,a.contents[g],h,a),b="seq"===a.timeContainer?a.contents[g].end:Math.max(b,a.contents[g].end),h=a.contents[g];else b=c?a.begin:Number.POSITIVE_INFINITY;a.end=null!==a.explicit_end&&null!==a.explicit_dur?Math.min(a.begin+a.explicit_dur,G+a.explicit_end):null===a.explicit_end&&null!==a.explicit_dur?a.begin+
a.explicit_dur:null!==a.explicit_end&&null===a.explicit_dur?G+a.explicit_end:b;delete a.explicit_begin;delete a.explicit_dur;delete a.explicit_end;d._registerEvent(a)}function x(a){this.node=a}function c(){this.events=[];this.head=new M;this.body=null}function M(){this.styling=new k;this.layout=new A}function k(){this.styles={};this.initials={}}function v(){this.styleRefs=this.styleAttrs=this.id=null}function t(){this.styleAttrs=null}function A(){this.regions={}}function B(a,d){this.kind="image";
this.src=a;this.type=d}function d(a){this.id=a}function h(a){this.regionID=a}function b(a){this.styleAttrs=a}function r(a){this.sets=a}function g(a){this.contents=a}function H(a,d,b){this.explicit_begin=a;this.explicit_end=d;this.explicit_dur=b}function R(){this.kind="body"}function O(){this.kind="div"}function p(){this.kind="p"}function E(){this.kind="span"}function C(){this.kind="span"}function D(){this.kind="br"}function z(){}function Q(){}function V(a){var d=null;a&&(a=a.attributes["xml:id"]||
a.attributes.id)&&(d=a.value||null);return d}function I(a){return a&&"style"in a.attributes?a.attributes.style.value.split(" "):[]}function S(a,d){var b={};if(null!==a)for(var h in a.attributes){var c=a.attributes[h].uri+" "+a.attributes[h].local,r=l.byQName[c];if(void 0!==r){var e=r.parse(a.attributes[h].value);null!==e?(b[c]=e,r===l.byName.zIndex&&L(d,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):K(d,"Cannot parse styling attribute "+c+" --\x3e "+a.attributes[h].value)}}return b}
function N(a,d,b){for(var h in a.attributes)if(a.attributes[h].uri===d&&a.attributes[h].local===b)return a.attributes[h].value;return null}function Z(a,d){a=N(a,m.ns_tts,"extent");if(null===a)return null;var b=a.split(" ");if(2!==b.length)return L(d,"Malformed extent (ignoring)"),null;a=q.parseLength(b[0]);b=q.parseLength(b[1]);return b&&a?{h:b,w:a}:(L(d,"Malformed extent values (ignoring)"),null)}function T(a,d,b){var h=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,c=/^(\d{2,}):(\d\d):(\d\d):(\d{2,})$/,r=
/^(\d+(?:\.\d+)?)t$/,e=/^(\d+(?:\.\d+)?)ms$/,g=/^(\d+(?:\.\d+)?)s$/,G=/^(\d+(?:\.\d+)?)h$/,u=/^(\d+(?:\.\d+)?)m$/,y,m=null;null!==(y=/^(\d+(?:\.\d+)?)f$/.exec(b))?null!==d&&(m=parseFloat(y[1])/d):null!==(y=r.exec(b))?null!==a&&(m=parseFloat(y[1])/a):null!==(y=e.exec(b))?m=parseFloat(y[1])/1E3:null!==(y=g.exec(b))?m=parseFloat(y[1]):null!==(y=G.exec(b))?m=3600*parseFloat(y[1]):null!==(y=u.exec(b))?m=60*parseFloat(y[1]):null!==(y=h.exec(b))?m=3600*parseInt(y[1])+60*parseInt(y[2])+parseFloat(y[3]):null!==
(y=c.exec(b))&&null!==d&&(m=3600*parseInt(y[1])+60*parseInt(y[2])+parseInt(y[3])+(null===y[4]?0:parseInt(y[4])/d));return m}function W(a,d,b){for(;0<d.styleRefs.length;){var h=d.styleRefs.pop();h in a.styles?(W(a,a.styles[h],b),U(a.styles[h].styleAttrs,d.styleAttrs)):K(b,"Non-existant style id referenced")}}function X(a,d,b,h){for(var c=d.length-1;0<=c;c--){var r=d[c];r in a.styles?U(a.styles[r].styleAttrs,b):K(h,"Non-existant style id referenced")}}function U(a,d){for(var b in a)b in d||(d[b]=a[b])}
function L(a,d){if(a&&a.warn&&a.warn(d))throw d;}function K(a,d){if(a&&a.error&&a.error(d))throw d;}function F(a,d){a&&a.fatal&&a.fatal(d);throw d;}function Y(a,d){for(var b=0,h=a.length-1,c;b<=h;){c=Math.floor((b+h)/2);var r=a[c];if(r<d)b=c+1;else if(r>d)h=c-1;else return{found:!0,index:c}}return{found:!1,index:b}}w.fromXML=function(d,b,h){var r=f.parser(!0,{xmlns:!0}),g=[],y=[],G=[],w=0,u=null;r.onclosetag=function(a){if(g[0]instanceof z)null!==u.head&&null!==u.head.styling&&X(u.head.styling,g[0].styleRefs,
g[0].styleAttrs,b),delete g[0].styleRefs;else if(g[0]instanceof k)for(var d in g[0].styles)W(g[0],g[0].styles[d],b);else if(g[0]instanceof p||g[0]instanceof E){if(1<g[0].contents.length){a=[g[0].contents[0]];for(d=1;d<g[0].contents.length;d++)g[0].contents[d]instanceof C&&a[a.length-1]instanceof C?a[a.length-1].text+=g[0].contents[d].text:a.push(g[0].contents[d]);g[0].contents=a}g[0]instanceof E&&1===g[0].contents.length&&g[0].contents[0]instanceof C&&(g[0].text=g[0].contents[0].text,delete g[0].contents)}else if(g[0]instanceof
x)if(g[0].node.uri===m.ns_tt&&"metadata"===g[0].node.local)w--;else if(0<w&&h&&"onCloseTag"in h)h.onCloseTag();G.shift();y.shift();g.shift()};r.ontext=function(a){if(void 0!==g[0])if(g[0]instanceof E||g[0]instanceof p){if(g[0]instanceof E){var d=g[0].styleAttrs[l.byName.ruby.qname];if("container"===d||"textContainer"===d||"baseContainer"===d)return}d=new C;d.initFromText(u,g[0],a,G[0],b);g[0].contents.push(d)}else if(g[0]instanceof x&&0<w&&h&&"onText"in h)h.onText(a)};r.onopentag=function(a){function d(a){m.ttaf_map[a.uri]&&
(a.uri=m.ttaf_map[a.uri])}var r=a.attributes["xml:space"];r?G.unshift(r.value):0===G.length?G.unshift("default"):G.unshift(G[0]);(r=a.attributes["xml:lang"])?y.unshift(r.value):0===y.length?y.unshift(""):y.unshift(y[0]);d(a);if(a.attributes)for(var e in a.attributes)a.attributes.hasOwnProperty(e)&&d(a.attributes[e]);if(a.uri===m.ns_tt)if("tt"===a.local)null!==u&&F(b,"Two <tt> elements at ("+this.line+","+this.column+")"),u=new c,u.initFromNode(a,b),g.unshift(u);else if("head"===a.local)g[0]instanceof
c||F(b,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),g.unshift(u.head);else if("styling"===a.local)g[0]instanceof M||F(b,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),g.unshift(u.head.styling);else if("style"===a.local)if(g[0]instanceof k){var f=new v;f.initFromNode(a,b);f.id?u.head.styling.styles[f.id]=f:K(b,"<style> element missing @id attribute");g.unshift(f)}else g[0]instanceof z?(f=new v,f.initFromNode(a,b),U(f.styleAttrs,g[0].styleAttrs),
g.unshift(f)):F(b,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")");else if("initial"===a.local)if(g[0]instanceof k){e=new t;e.initFromNode(a,b);for(f in e.styleAttrs)u.head.styling.initials[f]=e.styleAttrs[f];g.unshift(e)}else F(b,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")");else if("layout"===a.local)g[0]instanceof M||F(b,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),g.unshift(u.head.layout);
else if("region"===a.local)g[0]instanceof A||F(b,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")"),f=new z,f.initFromNode(u,a,b),!f.id||f.id in u.head.layout.regions?K(b,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):u.head.layout.regions[f.id]=f,g.unshift(f);else if("body"===a.local)g[0]instanceof c||F(b,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==u.body&&F(b,"Second <body> element at "+this.line+
","+this.column+")"),f=new R,f.initFromNode(u,a,b),u.body=f,g.unshift(f);else if("div"===a.local){g[0]instanceof O||g[0]instanceof R||F(b,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");f=new O;f.initFromNode(u,g[0],a,b);if(e=f.styleAttrs[l.byName.backgroundImage.qname])f.contents.push(new B(e)),delete f.styleAttrs[l.byName.backgroundImage.qname];g[0].contents.push(f);g.unshift(f)}else"image"===a.local?(g[0]instanceof O||F(b,"Parent of <image> element is not <div> at "+
this.line+","+this.column+")"),f=new B,f.initFromNode(u,g[0],a,b),g[0].contents.push(f),g.unshift(f)):"p"===a.local?(g[0]instanceof O||F(b,"Parent of <p> element is not <div> at "+this.line+","+this.column+")"),f=new p,f.initFromNode(u,g[0],a,b),g[0].contents.push(f),g.unshift(f)):"span"===a.local?(g[0]instanceof E||g[0]instanceof p||F(b,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")"),f=new E,f.initFromNode(u,g[0],a,G[0],b),g[0].contents.push(f),g.unshift(f)):"br"===
a.local?(g[0]instanceof E||g[0]instanceof p||F(b,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")"),f=new D,f.initFromNode(u,g[0],a,b),g[0].contents.push(f),g.unshift(f)):"set"===a.local?(g[0]instanceof E||g[0]instanceof p||g[0]instanceof O||g[0]instanceof R||g[0]instanceof z||g[0]instanceof D||F(b,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")"),f=new Q,f.initFromNode(u,g[0],a,b),g[0].sets.push(f),g.unshift(f)):g.unshift(new x(a));
else g.unshift(new x(a));if(g[0]instanceof x)if(a.uri===m.ns_tt&&"metadata"===a.local)w++;else if(0<w&&h&&"onOpenTag"in h){f=[];for(var P in a.attributes)f[a.attributes[P].uri+" "+a.attributes[P].local]={uri:a.attributes[P].uri,local:a.attributes[P].local,value:a.attributes[P].value};h.onOpenTag(a.uri,a.local,f)}};r.write(d).close();delete u.head.styling.styles;d=!1;for(var H in u.head.layout.regions){d=!0;break}d||(H=z.prototype.createDefaultRegion(u,b),u.head.layout.regions[H.id]=H);for(var q in u.head.layout.regions)e(u,
u.head.layout.regions[q],null,null);u.body&&e(u,u.body,null,null);u.body&&a(u.body);u.body&&n(u.body);return u};c.prototype.initFromNode=function(a,d){var b=N(a,m.ns_ttp,"cellResolution"),h=15;var g=32;null!==b&&(b=/(\d+) (\d+)/.exec(b),null!==b?(g=parseInt(b[1]),h=parseInt(b[2])):L(d,"Malformed cellResolution value (using initial value instead)"));this.cellLength={h:new q.ComputedLength(0,1/h),w:new q.ComputedLength(1/g,0)};h=N(a,m.ns_ttp,"frameRate");b=30;null!==h&&(g=/(\d+)/.exec(h),null!==g?b=
parseInt(g[1]):L(d,"Malformed frame rate attribute (using initial value instead)"));g=N(a,m.ns_ttp,"frameRateMultiplier");var r=1;null!==g&&(g=/(\d+) (\d+)/.exec(g),null!==g?r=parseInt(g[1])/parseInt(g[2]):L(d,"Malformed frame rate multiplier attribute (using initial value instead)"));b*=r;r=1;g=N(a,m.ns_ttp,"tickRate");null===g?null!==h&&(r=b):(g=/(\d+)/.exec(g),null!==g?r=parseInt(g[1]):L(d,"Malformed tick rate attribute (using initial value instead)"));this.effectiveFrameRate=b;this.tickRate=r;
g=N(a,m.ns_ittp,"aspectRatio");null===g&&(g=N(a,m.ns_ttp,"displayAspectRatio"));h=null;null!==g&&(b=/(\d+)\s+(\d+)/.exec(g),null!==b?(g=parseInt(b[1]),b=parseInt(b[2]),0!==g&&0!==b?h=g/b:K(d,"Illegal aspectRatio values (ignoring)")):K(d,"Malformed aspectRatio attribute (ignoring)"));this.aspectRatio=h;h=N(a,m.ns_ttp,"timeBase");null!==h&&"media"!==h&&F(d,"Unsupported time base");a=Z(a,d);null===a?this.pxLength={h:null,w:null}:("px"===a.h.unit&&"px"===a.w.unit||F(d,"Extent on TT must be in px or absent"),
this.pxLength={h:new q.ComputedLength(0,1/a.h.value),w:new q.ComputedLength(1/a.w.value,0)});this.dimensions={h:new q.ComputedLength(0,1),w:new q.ComputedLength(1,0)}};c.prototype._registerEvent=function(a){if(!(a.end<=a.begin)){var d=Y(this.events,a.begin);d.found||this.events.splice(d.index,0,a.begin);a.end!==Number.POSITIVE_INFINITY&&(d=Y(this.events,a.end),d.found||this.events.splice(d.index,0,a.end))}};c.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-
1]]};c.prototype.getMediaTimeEvents=function(){return this.events};v.prototype.initFromNode=function(a,d){this.id=V(a);this.styleAttrs=S(a,d);this.styleRefs=I(a)};t.prototype.initFromNode=function(a,d){this.styleAttrs={};for(var b in a.attributes)if(a.attributes[b].uri===m.ns_itts||a.attributes[b].uri===m.ns_ebutts||a.attributes[b].uri===m.ns_tts)this.styleAttrs[a.attributes[b].uri+" "+a.attributes[b].local]=a.attributes[b].value};B.prototype.initFromNode=function(a,d,g,c){(this.src="src"in g.attributes?
g.attributes.src.value:null)||K(c,"Invalid image@src attribute");(this.type="type"in g.attributes?g.attributes.type.value:null)||K(c,"Invalid image@type attribute");b.prototype.initFromNode.call(this,a,d,g,c);H.prototype.initFromNode.call(this,a,d,g,c);r.prototype.initFromNode.call(this,a,d,g,c);h.prototype.initFromNode.call(this,a,d,g,c)};d.prototype.initFromNode=function(a,d,b,g){this.id=V(b)};h.prototype.initFromNode=function(a,d,b,g){this.regionID=b&&"region"in b.attributes?b.attributes.region.value:
""};b.prototype.initFromNode=function(a,d,b,g){this.styleAttrs=S(b,g);null!==a.head&&null!==a.head.styling&&X(a.head.styling,I(b),this.styleAttrs,g)};r.prototype.initFromNode=function(a,d,b,g){this.sets=[]};g.prototype.initFromNode=function(a,d,b,g){this.contents=[]};H.prototype.initFromNode=function(a,d,b,g){d=null;b&&"begin"in b.attributes&&(d=T(a.tickRate,a.effectiveFrameRate,b.attributes.begin.value),null===d&&L(g,"Malformed begin value "+b.attributes.begin.value+" (using 0)"));var h=null;b&&
"dur"in b.attributes&&(h=T(a.tickRate,a.effectiveFrameRate,b.attributes.dur.value),null===h&&L(g,"Malformed dur value "+b.attributes.dur.value+" (ignoring)"));var r=null;b&&"end"in b.attributes&&(r=T(a.tickRate,a.effectiveFrameRate,b.attributes.end.value),null===r&&L(g,"Malformed end value (ignoring)"));this.explicit_begin=d;this.explicit_end=r;this.explicit_dur=h;(a=b&&"timeContainer"in b.attributes?b.attributes.timeContainer.value:null)&&"par"!==a?"seq"===a?g="seq":(K(g,"Illegal value of timeContainer (assuming 'par')"),
g="par"):g="par";this.timeContainer=g};R.prototype.initFromNode=function(a,d,c){b.prototype.initFromNode.call(this,a,null,d,c);H.prototype.initFromNode.call(this,a,null,d,c);r.prototype.initFromNode.call(this,a,null,d,c);h.prototype.initFromNode.call(this,a,null,d,c);g.prototype.initFromNode.call(this,a,null,d,c)};O.prototype.initFromNode=function(a,d,c,e){b.prototype.initFromNode.call(this,a,d,c,e);H.prototype.initFromNode.call(this,a,d,c,e);r.prototype.initFromNode.call(this,a,d,c,e);h.prototype.initFromNode.call(this,
a,d,c,e);g.prototype.initFromNode.call(this,a,d,c,e)};p.prototype.initFromNode=function(a,d,c,e){b.prototype.initFromNode.call(this,a,d,c,e);H.prototype.initFromNode.call(this,a,d,c,e);r.prototype.initFromNode.call(this,a,d,c,e);h.prototype.initFromNode.call(this,a,d,c,e);g.prototype.initFromNode.call(this,a,d,c,e)};E.prototype.initFromNode=function(a,d,c,e,f){b.prototype.initFromNode.call(this,a,d,c,f);H.prototype.initFromNode.call(this,a,d,c,f);r.prototype.initFromNode.call(this,a,d,c,f);h.prototype.initFromNode.call(this,
a,d,c,f);g.prototype.initFromNode.call(this,a,d,c,f);this.space=e};C.prototype.initFromText=function(a,d,b,g,h){H.prototype.initFromNode.call(this,a,d,null,h);this.text=b;this.space=g};D.prototype.initFromNode=function(a,d,b,g){h.prototype.initFromNode.call(this,a,d,b,g);H.prototype.initFromNode.call(this,a,d,b,g)};z.prototype.createDefaultRegion=function(a,d){var g=new z;g.id="";b.prototype.initFromNode.call(g,a,null,{name:"region",attributes:{"tts:displayAlign":{name:"tts:displayAlign",value:"after",
prefix:"tts",local:"displayAlign",uri:"http://www.w3.org/ns/ttml#styling"},"tts:extent":{name:"tts:extent",value:"80% 20%",prefix:"tts",local:"extent",uri:"http://www.w3.org/ns/ttml#styling"},"tts:origin":{name:"tts:origin",value:"10% 70%",prefix:"tts",local:"origin",uri:"http://www.w3.org/ns/ttml#styling"},"tts:overflow":{name:"tts:overflow",value:"visible",prefix:"tts",local:"overflow",uri:"http://www.w3.org/ns/ttml#styling"}},ns:{"":"http://www.w3.org/ns/ttml",ebuttm:"urn:ebu:tt:metadata",ebutts:"urn:ebu:tt:style",
ittp:"http://www.w3.org/ns/ttml/profile/imsc1#parameter",itts:"http://www.w3.org/ns/ttml/profile/imsc1#styling",ttm:"http://www.w3.org/ns/ttml#metadata",ttp:"http://www.w3.org/ns/ttml#parameter",tts:"http://www.w3.org/ns/ttml#styling",xml:"http://www.w3.org/XML/1998/namespace"},prefix:"",local:"region",uri:"http://www.w3.org/ns/ttml",isSelfClosing:!0},d);g.sets=[];H.call(g,0,Number.POSITIVE_INFINITY,null);return g};z.prototype.initFromNode=function(a,b,g){d.prototype.initFromNode.call(this,a,null,
b,g);H.prototype.initFromNode.call(this,a,null,b,g);r.prototype.initFromNode.call(this,a,null,b,g);this.styleAttrs=S(b,g);this.styleRefs=I(b)};Q.prototype.initFromNode=function(a,d,b,g){H.prototype.initFromNode.call(this,a,d,b,g);a=S(b,g);this.value=this.qname=null;for(var h in a){if(this.qname){K(g,"More than one style specified on set");break}this.qname=h;this.value=a[h]}}})("undefined"===typeof q?this.imscDoc={}:q,"undefined"===typeof sax?f("sax"):sax,"undefined"===typeof imscNames?f("./names"):
imscNames,"undefined"===typeof imscStyles?f("./styles"):imscStyles,"undefined"===typeof imscUtils?f("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7,sax:void 0}],2:[function(f,t,q){(function(f,n,m,l){function w(d,h,b){if("region"===b.kind){var c=document.createElement("div");c.style.position="absolute"}else if("body"===b.kind)c=document.createElement("div");else if("div"===b.kind)c=document.createElement("div");else if("image"===b.kind){if(c=document.createElement("img"),null!==d.imgResolver&&
null!==b.src){var g=d.imgResolver(b.src,c);g&&(c.src=g);c.height=d.regionH;c.width=d.regionW}}else if("p"===b.kind)c=document.createElement("p");else if("span"===b.kind)if("container"===b.styleAttrs[m.byName.ruby.qname])c=document.createElement("ruby"),d.ruby=!0;else if("base"===b.styleAttrs[m.byName.ruby.qname])c=document.createElement("rb");else if("text"===b.styleAttrs[m.byName.ruby.qname])c=document.createElement("rt");else if("baseContainer"===b.styleAttrs[m.byName.ruby.qname])c=document.createElement("rbc");
else if("textContainer"===b.styleAttrs[m.byName.ruby.qname])c=document.createElement("rtc");else{if("delimiter"===b.styleAttrs[m.byName.ruby.qname])return;c=document.createElement("span")}else"br"===b.kind&&(c=document.createElement("br"));if(c){h.appendChild(c);c.style.margin="0";if("region"===b.kind)if(h=b.styleAttrs[m.byName.writingMode.qname],"lrtb"===h||"lr"===h)d.ipd="lr",d.bpd="tb";else if("rltb"===h||"rl"===h)d.ipd="rl",d.bpd="tb";else if("tblr"===h)d.ipd="tb",d.bpd="lr";else{if("tbrl"===
h||"tb"===h)d.ipd="tb",d.bpd="rl"}else"p"===b.kind&&"tb"===d.bpd&&(d.ipd="ltr"===b.styleAttrs[m.byName.direction.qname]?"lr":"rl");for(var f in M)h=M[f],g=b.styleAttrs[h.qname],void 0!==g&&null!==h.map&&h.map(d,c,b,g);f=c;(h=b.styleAttrs[m.byName.linePadding.qname])&&!h.isZero()&&(g=h.multiply(h.toUsedLength(d.w,d.h),d.options.sizeAdjust),0<g&&(g=Math.ceil(g)+"px","tb"===d.bpd?(f.style.paddingLeft=g,f.style.paddingRight=g):(f.style.paddingTop=g,f.style.paddingBottom=g),d.lp=h));(h=b.styleAttrs[m.byName.multiRowAlign.qname])&&
"auto"!==h&&(f=document.createElement("span"),f.style.display="inline-block",f.style.textAlign=h,c.appendChild(f),d.mra=h);(h=b.styleAttrs[m.byName.rubyReserve.qname])&&"none"!==h[0]&&(d.rubyReserve=h);b.styleAttrs[m.byName.fillLineGap.qname]&&(d.flg=!0);if("span"===b.kind&&b.text)if((h=b.styleAttrs[m.byName.textEmphasis.qname])&&"none"!==h.style&&(d.textEmphasis=!0),m.byName.textCombine.qname in b.styleAttrs&&"all"===b.styleAttrs[m.byName.textCombine.qname][0])c.textContent=b.text,h&&x(d,c,b,h);
else{g="";for(var k=0;k<b.text.length;k++){g+=b.text.charAt(k);var l=b.text.charCodeAt(k);if(55296>l||56319<l||k===b.text.length)l=document.createElement("span"),l.textContent=g,h&&x(d,l,b,h),c.appendChild(l),g=""}}for(var p in b.contents)w(d,f,b.contents[p]);p=[];if((d.lp||d.mra||d.flg||d.ruby||d.textEmphasis||d.rubyReserve)&&"p"===b.kind){e(d,f,p,null);if(d.rubyReserve){for(h=0;h<p.length;h++){g=document.createElement("ruby");k=document.createElement("rb");k.textContent="\u200b";g.appendChild(k);
var n=d.rubyReserve[1].toUsedLength(d.w,d.h)+"px";"both"===d.rubyReserve[0]||"outside"===d.rubyReserve[0]&&1==p.length?(k=document.createElement("rtc"),k.style[t]=v?"after":"under",k.textContent="\u200b",k.style.fontSize=n,l=document.createElement("rtc"),l.style[t]=v?"before":"over",l.textContent="\u200b",l.style.fontSize=n,g.appendChild(k),g.appendChild(l)):(k=document.createElement("rtc"),k.textContent="\u200b",k.style.fontSize=n,k.style[t]="after"===d.rubyReserve[0]||"outside"===d.rubyReserve[0]&&
0<h?v?"after":"tb"===d.bpd||"rl"===d.bpd?"under":"over":v?"before":"tb"===d.bpd||"rl"===d.bpd?"over":"under",g.appendChild(k));k=null;for(l=0;l<p[h].rbc.length;l++)if("ruby"===p[h].rbc[l].localName){k=p[h].rbc[l];for(l=0;l<k.style.length;l++)g.style.setProperty(k.style.item(l),k.style.getPropertyValue(k.style.item(l)));break}k=k||p[h].elements[0].node;k.parentElement.insertBefore(g,k)}d.rubyReserve=null}if(d.ruby||d.rubyReserve){for(h=0;h<p.length;h++)for(g=0;g<p[h].rbc.length;g++)p[h].rbc[g].style[t]||
(p[h].rbc[g].style[t]=v?0===h?"before":"after":"tb"===d.bpd?0===h?"over":"under":"rl"===d.bpd?0===h?"over":"under":0===h?"under":"over");d.ruby=null}if(d.textEmphasis){for(h=0;h<p.length;h++)for(g=0;g<p[h].te.length;g++)p[h].te[g].style[B]&&"none"!==p[h].te[g].style[B]||(p[h].te[g].style[B]="tb"===d.bpd?0===h?"left over":"left under":"rl"===d.bpd?0===h?"right under":"left under":0===h?"left under":"right under");d.textEmphasis=null}if(d.mra){for(h=0;h<p.length-1;h++)k=p[h].elements.length,0!==k&&
!1===p[h].br&&(g=document.createElement("br"),k=p[h].elements[k-1].node,k.parentElement.insertBefore(g,k.nextSibling));d.mra=null}if(d.lp){h=d.lp.multiply(d.lp.toUsedLength(d.w,d.h),d.options.sizeAdjust);for(var C in p)g=p[C].elements[p[C].start_elem],k=p[C].elements[p[C].end_elem],l=Math.ceil(h)+"px",n="-"+Math.ceil(h)+"px",0!==p[C].elements.length&&("lr"===d.ipd?(g.node.style.borderLeftColor=g.bgcolor||"#00000000",g.node.style.borderLeftStyle="solid",g.node.style.borderLeftWidth=l,g.node.style.marginLeft=
n):"rl"===d.ipd?(g.node.style.borderRightColor=g.bgcolor||"#00000000",g.node.style.borderRightStyle="solid",g.node.style.borderRightWidth=l,g.node.style.marginRight=n):"tb"===d.ipd&&(g.node.style.borderTopColor=g.bgcolor||"#00000000",g.node.style.borderTopStyle="solid",g.node.style.borderTopWidth=l,g.node.style.marginTop=n),"lr"===d.ipd?(k.node.style.borderRightColor=k.bgcolor||"#00000000",k.node.style.borderRightStyle="solid",k.node.style.borderRightWidth=l,k.node.style.marginRight=n):"rl"===d.ipd?
(k.node.style.borderLeftColor=k.bgcolor||"#00000000",k.node.style.borderLeftStyle="solid",k.node.style.borderLeftWidth=l,k.node.style.marginLeft=n):"tb"===d.ipd&&(k.node.style.borderBottomColor=k.bgcolor||"#00000000",k.node.style.borderBottomStyle="solid",k.node.style.borderBottomWidth=l,k.node.style.marginBottom=n));d.lp=null}if(d.flg){h=a(f.getBoundingClientRect(),d);C=h.before;h=h.after;g=Math.sign(h-C);for(k=0;k<=p.length;k++){l=0===k?C:k===p.length?h:(p[k].before+p[k-1].after)/2;if(0<k)for(var A=
0;A<p[k-1].elements.length;A++)if(null!==p[k-1].elements[A].bgcolor){var z=p[k-1].elements[A];0>g*(z.after-l)&&(n=Math.ceil(Math.abs(l-z.after))+"px",z.node.style.backgroundColor=z.bgcolor,"lr"===d.bpd?z.node.style.paddingRight=n:"rl"===d.bpd?z.node.style.paddingLeft=n:"tb"===d.bpd&&(z.node.style.paddingBottom=n))}if(k<p.length)for(A=0;A<p[k].elements.length;A++)z=p[k].elements[A],null!==z.bgcolor&&0<g*(z.before-l)&&(n=Math.ceil(Math.abs(z.before-l))+"px",z.node.style.backgroundColor=z.bgcolor,"lr"===
d.bpd?z.node.style.paddingLeft=n:"rl"===d.bpd?z.node.style.paddingRight=n:"tb"===d.bpd&&(z.node.style.paddingTop=n))}d.flg=null}}"region"===b.kind&&(e(d,f,p),"tb"===d.bpd&&d.enableRollUp&&0<b.contents.length&&"after"===b.styleAttrs[m.byName.displayAlign.qname]&&(b=new q(""===b.id?"_":b.id,p),d.currentISDState[b.id]=b,d.previousISDState&&b.id in d.previousISDState&&0<d.previousISDState[b.id].plist.length&&1<b.plist.length&&b.plist[b.plist.length-2].text===d.previousISDState[b.id].plist[d.previousISDState[b.id].plist.length-
1].text&&(d=c.firstElementChild,b=b.plist[b.plist.length-1].after-b.plist[b.plist.length-1].before,d.style.bottom="-"+b+"px",d.style.transition="transform 0.4s",d.style.position="relative",d.style.transform="translateY(-"+b+"px)")))}else if(d=d.errorHandler,b="Error processing ISD element kind: "+b.kind,d&&d.error&&d.error(b))throw b;}function q(a,h){this.id=a;this.plist=h}function a(a,h){var d={before:null,after:null,start:null,end:null};"tb"===h.bpd?(d.before=a.top,d.after=a.bottom,"lr"===h.ipd?
(d.start=a.left,d.end=a.right):(d.start=a.right,d.end=a.left)):"lr"===h.bpd?(d.before=a.left,d.after=a.right,d.start=a.top,d.end=a.bottom):"rl"===h.bpd&&(d.before=a.right,d.after=a.left,d.start=a.top,d.end=a.bottom);return d}function e(d,h,b,c){if("rt"!==h.localName&&"rtc"!==h.localName)if(c=h.style.backgroundColor||c,0===h.childElementCount)if("span"===h.localName||"rb"===h.localName){var g=h.getBoundingClientRect();if(0!==g.height&&0!==g.width){d=a(g,d);if(!(g=0===b.length)){g=d.before;var r=d.after,
k=b[b.length-1].before,f=b[b.length-1].after;g=!(r<f&&g>k||f<=r&&k>=g)}g?b.push({before:d.before,after:d.after,start:d.start,end:d.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1}):(g=Math.sign(d.after-d.before),r=Math.sign(d.end-d.start),0>g*(d.before-b[b.length-1].before)&&(b[b.length-1].before=d.before),0<g*(d.after-b[b.length-1].after)&&(b[b.length-1].after=d.after),0>r*(d.start-b[b.length-1].start)&&(b[b.length-1].start=d.start,b[b.length-1].start_elem=b[b.length-1].elements.length),
0<r*(d.end-b[b.length-1].end)&&(b[b.length-1].end=d.end,b[b.length-1].end_elem=b[b.length-1].elements.length));b[b.length-1].text+=h.textContent;b[b.length-1].elements.push({node:h,bgcolor:c,before:d.before,after:d.after})}}else"br"===h.localName&&0!==b.length&&(b[b.length-1].br=!0);else for(h=h.firstChild;h;)h.nodeType===Node.ELEMENT_NODE&&(e(d,h,b,c),"ruby"===h.localName||"rtc"===h.localName?0<b.length&&b[b.length-1].rbc.push(h):"span"===h.localName&&h.style[A]&&"none"!==h.style[A]&&0<b.length&&
b[b.length-1].te.push(h)),h=h.nextSibling}function x(a,h,b,c){if("none"===c.style)h.style[A]="none";else if(h.style[A]="auto"===c.style?"filled":c.style+" "+c.symbol,"before"===c.position||"after"===c.position)h.style[B]="tb"===a.bpd?"before"===c.position?"left over":"left under":"rl"===a.bpd?"before"===c.position?"right under":"left under":"before"===c.position?"left under":"right under"}function c(a,h){this.qname=a;this.map=h}f.render=function(a,h,b,c,g,e,k,f,m,x){c=c||h.clientHeight;g=g||h.clientWidth;
if(null!==a.aspectRatio){var d=c*a.aspectRatio;d>g?c=Math.round(g/a.aspectRatio):g=d}d=document.createElement("div");d.style.position="relative";d.style.width=g+"px";d.style.height=c+"px";d.style.margin="auto";d.style.top=0;d.style.bottom=0;d.style.left=0;d.style.right=0;d.style.zIndex=0;if(x&&x.colorAdjust){var r={};colorAdjustMapEntries=Object.entries(x.colorAdjust);for(var n in colorAdjustMapEntries)fromColor=l.parseColor(colorAdjustMapEntries[n][0]),toColor=l.parseColor(colorAdjustMapEntries[n][1]),
fromColor&&toColor&&(r[fromColor.toString()]=toColor);x.colorAdjust=r}b={h:c,w:g,regionH:null,regionW:null,imgResolver:b,displayForcedOnlyMode:e||!1,isd:a,errorHandler:k,previousISDState:f,enableRollUp:m||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null,options:x||{}};h.appendChild(d);for(var p in a.contents)w(b,d,a.contents[p]);return b.currentISDState};var M=[new c("http://www.w3.org/ns/ttml#styling backgroundColor",function(a,h,b,c){b=
c[3];0!==b&&(void 0!=a.options.backgroundOpacityScale&&(b*=a.options.backgroundOpacityScale),h.style.backgroundColor="rgba("+c[0].toString()+","+c[1].toString()+","+c[2].toString()+","+(b/255).toString()+")")}),new c("http://www.w3.org/ns/ttml#styling color",function(a,h,b,c){opacityMultiplier=a.options.colorOpacityScale||1;colorAdjustMap=a.options.colorAdjust;void 0!=colorAdjustMap&&(map_attr=colorAdjustMap[c.toString()])&&(c=map_attr);h.style.color="rgba("+c[0].toString()+","+c[1].toString()+","+
c[2].toString()+","+(opacityMultiplier*c[3]/255).toString()+")"}),new c("http://www.w3.org/ns/ttml#styling direction",function(a,h,b,c){h.style.direction=c}),new c("http://www.w3.org/ns/ttml#styling display",function(a,h,b,c){}),new c("http://www.w3.org/ns/ttml#styling displayAlign",function(a,c,b,e){c.style.display="flex";c.style.flexDirection="column";"before"===e?c.style.justifyContent="flex-start":"center"===e?c.style.justifyContent="center":"after"===e&&(c.style.justifyContent="flex-end")}),
new c("http://www.w3.org/ns/ttml#styling extent",function(a,c,b,e){a.regionH=e.h.toUsedLength(a.w,a.h);a.regionW=e.w.toUsedLength(a.w,a.h);var d=e=0;if(b=b.styleAttrs["http://www.w3.org/ns/ttml#styling padding"])e=b[0].toUsedLength(a.w,a.h)+b[2].toUsedLength(a.w,a.h),d=b[1].toUsedLength(a.w,a.h)+b[3].toUsedLength(a.w,a.h);c.style.height=a.regionH-e+"px";c.style.width=a.regionW-d+"px"}),new c("http://www.w3.org/ns/ttml#styling fontFamily",function(a,c,b,e){b=[];a.options.fontFamily&&(e=a.options.fontFamily.split(","));
for(var d in e)e[d]=e[d].trim(),"monospaceSerif"===e[d]?(b.push("Courier New"),b.push('"Liberation Mono"'),b.push("Courier"),b.push("monospace")):"proportionalSansSerif"===e[d]||"default"===e[d]?(b.push("Arial"),b.push("Helvetica"),b.push('"Liberation Sans"'),b.push("sans-serif")):"monospace"===e[d]?b.push("monospace"):"sansSerif"===e[d]?b.push("sans-serif"):"serif"===e[d]?b.push("serif"):"monospaceSansSerif"===e[d]?(b.push("Consolas"),b.push("monospace")):"proportionalSerif"===e[d]?b.push("serif"):
b.push(e[d]);c.style.fontFamily=b.join(",")}),new c("http://www.w3.org/ns/ttml#styling shear",function(a,c,b,e){0!==e&&(b=-.9*e,c.style.transform="tb"===a.bpd?"skewX("+b+"deg)":"skewY("+b+"deg)")}),new c("http://www.w3.org/ns/ttml#styling fontSize",function(a,c,b,e){c.style.fontSize=e.multiply(e.toUsedLength(a.w,a.h),a.options.sizeAdjust)+"px"}),new c("http://www.w3.org/ns/ttml#styling fontStyle",function(a,c,b,e){c.style.fontStyle=e}),new c("http://www.w3.org/ns/ttml#styling fontWeight",function(a,
c,b,e){c.style.fontWeight=e}),new c("http://www.w3.org/ns/ttml#styling lineHeight",function(a,c,b,e){c.style.lineHeight="normal"===e?"normal":e.multiply(e.toUsedLength(a.w,a.h),a.options.sizeAdjust)+"px"}),new c("http://www.w3.org/ns/ttml#styling opacity",function(a,c,b,e){b=e;void 0!=a.options.regionOpacityScale&&(b*=a.options.regionOpacityScale);c.style.opacity=b}),new c("http://www.w3.org/ns/ttml#styling origin",function(a,c,b,e){c.style.top=e.h.toUsedLength(a.w,a.h)+"px";c.style.left=e.w.toUsedLength(a.w,
a.h)+"px"}),new c("http://www.w3.org/ns/ttml#styling overflow",function(a,c,b,e){c.style.overflow=e}),new c("http://www.w3.org/ns/ttml#styling padding",function(a,c,b,e){b=[];b[0]=e[0].toUsedLength(a.w,a.h)+"px";b[1]=e[3].toUsedLength(a.w,a.h)+"px";b[2]=e[2].toUsedLength(a.w,a.h)+"px";b[3]=e[1].toUsedLength(a.w,a.h)+"px";c.style.padding=b.join(" ")}),new c("http://www.w3.org/ns/ttml#styling position",function(a,c,b,e){c.style.top=e.h.toUsedLength(a.w,a.h)+"px";c.style.left=e.w.toUsedLength(a.w,a.h)+
"px"}),new c("http://www.w3.org/ns/ttml#styling rubyAlign",function(a,c,b,e){c.style.rubyAlign="spaceAround"===e?"space-around":"center"}),new c("http://www.w3.org/ns/ttml#styling rubyPosition",function(a,c,b,e){if("before"===e||"after"===e)c.parentElement.style[t]=v?e:"tb"===a.bpd?"before"===e?"over":"under":"rl"===a.bpd?"before"===e?"over":"under":"before"===e?"under":"over"}),new c("http://www.w3.org/ns/ttml#styling showBackground",null),new c("http://www.w3.org/ns/ttml#styling textAlign",function(a,
c,b,e){c.style.textAlign="start"===e?"rl"===a.ipd?"right":"left":"end"===e?"rl"===a.ipd?"left":"right":e}),new c("http://www.w3.org/ns/ttml#styling textDecoration",function(a,c,b,e){c.style.textDecoration=e.join(" ").replace("lineThrough","line-through")}),new c("http://www.w3.org/ns/ttml#styling textOutline",function(a,c,b,e){}),new c("http://www.w3.org/ns/ttml#styling textShadow",function(a,c,b,e){b=b.styleAttrs[m.byName.textOutline.qname];var d=a.options.textOutline;if(d)if("none"===d)b=d;else{var h=
{};d=d.split(" ");if(0!==d.length&&2>=d.length){var k=l.parseColor(d[0]);h.color=k;null!==k&&d.shift();1===d.length&&(d=l.parseLength(d[0]))&&(h.thickness=d,b=h)}}if("none"===e&&"none"===b)c.style.textShadow="";else{h=[];"none"!==b&&(b="rgba("+b.color[0].toString()+","+b.color[1].toString()+","+b.color[2].toString()+","+(b.color[3]/255).toString()+")",h.push("1px 1px 1px "+b),h.push("-1px 1px 1px "+b),h.push("1px -1px 1px "+b),h.push("-1px -1px 1px "+b));if("none"!==e)for(var f in e)h.push(e[f].x_off.toUsedLength(a.w,
a.h)+"px "+e[f].y_off.toUsedLength(a.w,a.h)+"px "+e[f].b_radius.toUsedLength(a.w,a.h)+"px rgba("+e[f].color[0].toString()+","+e[f].color[1].toString()+","+e[f].color[2].toString()+","+(e[f].color[3]/255).toString()+")");c.style.textShadow=h.join(",")}}),new c("http://www.w3.org/ns/ttml#styling textCombine",function(a,c,b,e){c.style.textCombineUpright=e.join(" ")}),new c("http://www.w3.org/ns/ttml#styling textEmphasis",function(a,c,b,e){}),new c("http://www.w3.org/ns/ttml#styling unicodeBidi",function(a,
c,b,e){c.style.unicodeBidi="bidiOverride"===e?"bidi-override":e}),new c("http://www.w3.org/ns/ttml#styling visibility",function(a,c,b,e){c.style.visibility=e}),new c("http://www.w3.org/ns/ttml#styling wrapOption",function(a,c,b,e){c.style.whiteSpace="wrap"===e?"preserve"===b.space?"pre-wrap":"normal":"preserve"===b.space?"pre":"noWrap"}),new c("http://www.w3.org/ns/ttml#styling writingMode",function(a,c,b,e){if("lrtb"===e||"lr"===e)c.style.writingMode="horizontal-tb";else if("rltb"===e||"rl"===e)c.style.writingMode=
"horizontal-tb";else if("tblr"===e)c.style.writingMode="vertical-lr";else if("tbrl"===e||"tb"===e)c.style.writingMode="vertical-rl"}),new c("http://www.w3.org/ns/ttml#styling zIndex",function(a,c,b,e){c.style.zIndex=e}),new c("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(a,c,b,e){a.displayForcedOnlyMode&&!1===e&&(c.style.visibility="hidden")})],k;for(k in M);var v="webkitRubyPosition"in window.getComputedStyle(document.documentElement),t=v?"webkitRubyPosition":"rubyPosition",
A="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",B="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition"})("undefined"===typeof q?this.imscHTML={}:q,"undefined"===typeof imscNames?f("./names"):imscNames,"undefined"===typeof imscStyles?f("./styles"):imscStyles,"undefined"===typeof imscUtils?f("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],
3:[function(f,t,q){(function(f,n,m,l){function w(k,f,x,n,B,d,h,b,r){if(f<h.begin||f>=h.end)return null;d="regionID"in h&&""!==h.regionID?h.regionID:d;if(null!==B&&d!==x.id&&(!("contents"in h)||"contents"in h&&0===h.contents.length||""!==d))return null;var g=new c(h);for(A in h.sets)f<h.sets[A].begin||f>=h.sets[A].end||(g.styleAttrs[h.sets[A].qname]=h.sets[A].value);var A={};for(var v in g.styleAttrs)if(A[v]=!0,"region"===g.kind&&v===m.byName.writingMode.qname&&!(m.byName.direction.qname in g.styleAttrs)){var t=
g.styleAttrs[v];if("lrtb"===t||"lr"===t)g.styleAttrs[m.byName.direction.qname]="ltr";else if("rltb"===t||"rl"===t)g.styleAttrs[m.byName.direction.qname]="rtl"}if(null!==B)for(var p in m.all)if(v=m.all[p],v.qname===m.byName.textDecoration.qname){t=B.styleAttrs[v.qname];var E=g.styleAttrs[v.qname],C=[];void 0===E?C=t:-1===E.indexOf("none")?((-1===E.indexOf("noUnderline")&&-1!==t.indexOf("underline")||-1!==E.indexOf("underline"))&&C.push("underline"),(-1===E.indexOf("noLineThrough")&&-1!==t.indexOf("lineThrough")||
-1!==E.indexOf("lineThrough"))&&C.push("lineThrough"),(-1===E.indexOf("noOverline")&&-1!==t.indexOf("overline")||-1!==E.indexOf("overline"))&&C.push("overline")):C.push("none");g.styleAttrs[v.qname]=C}else v.qname!==m.byName.fontSize.qname||v.qname in g.styleAttrs||"span"!==g.kind||"textContainer"!==g.styleAttrs[m.byName.ruby.qname]?v.qname!==m.byName.fontSize.qname||v.qname in g.styleAttrs||"span"!==g.kind||"text"!==g.styleAttrs[m.byName.ruby.qname]?v.inherit&&v.qname in B.styleAttrs&&!(v.qname in
g.styleAttrs)&&(g.styleAttrs[v.qname]=B.styleAttrs[v.qname]):(t=B.styleAttrs[m.byName.fontSize.qname],g.styleAttrs[v.qname]="textContainer"===B.styleAttrs[m.byName.ruby.qname]?t:new l.ComputedLength(.5*t.rw,.5*t.rh)):(t=B.styleAttrs[m.byName.fontSize.qname],g.styleAttrs[v.qname]=new l.ComputedLength(.5*t.rw,.5*t.rh));for(var D in m.all)if(p=m.all[D],!(p.qname in g.styleAttrs||p.qname===m.byName.position.qname&&m.byName.origin.qname in g.styleAttrs||p.qname===m.byName.origin.qname&&m.byName.position.qname in
g.styleAttrs)&&(v=k.head.styling.initials[p.qname]||p.initial,null!==v&&("region"===g.kind||!1===p.inherit&&null!==v)))if(v=p.parse(v),null!==v)g.styleAttrs[p.qname]=v,A[p.qname]=!0;else if(p="Invalid initial value for '"+p.qname+"' on element '"+g.kind,b&&b.error&&b.error(p))throw p;for(var z in m.all)if(D=m.all[z],D.qname in A&&null!==D.compute)if(p=D.compute(k,B,g,g.styleAttrs[D.qname],r),null!==p)g.styleAttrs[D.qname]=p;else if(g.styleAttrs[D.qname]=D.compute(k,B,g,D.parse(D.initial),r),D="Style '"+
D.qname+"' on element '"+g.kind+"' cannot be computed",b&&b.error&&b.error(D))throw D;if("none"===g.styleAttrs[m.byName.display.qname])return null;if(null===B)var J=null===n?[]:[n];else"contents"in h&&(J=h.contents);for(var Q in J)B=w(k,f,x,n,g,d,J[Q],b,r),null!==B&&g.contents.push(B.element);for(var I in g.styleAttrs)k=!1,"span"===g.kind&&(f=g.styleAttrs[m.byName.ruby.qname],(k=("container"===f||"textContainer"===f||"baseContainer"===f)&&-1!==M.indexOf(I))||(k="container"!==f&&I===m.byName.rubyAlign.qname),
k||(k=!("textContainer"===f||"text"===f)&&I===m.byName.rubyPosition.qname)),k||(k=-1===m.byQName[I].applies.indexOf(g.kind)),k&&delete g.styleAttrs[I];I=g.styleAttrs[m.byName.ruby.qname];if("p"===g.kind||"span"===g.kind&&("textContainer"===I||"text"===I))I=[],a(g,I),q(I),e(g);return"div"===g.kind&&m.byName.backgroundImage.qname in g.styleAttrs||"br"===g.kind||"image"===g.kind||"contents"in g&&0<g.contents.length||"span"===g.kind&&null!==g.text||"region"===g.kind&&"always"===g.styleAttrs[m.byName.showBackground.qname]?
{region_id:d,element:g}:null}function q(a){function c(a){return"br"===a.kind||/[\r\n\t ]$/.test(a.text)}function e(a){return"br"===a.kind||"preserve"===a.space&&/^[\r\n]/.test(a.text)}for(var f,k=0;k<a.length;)if(f=a[k],"br"===f.kind||"preserve"===f.space)k++;else{var d=f.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(d)&&(0===k||c(a[k-1]))&&(d=d.substring(1));f.text=d;0===d.length?a.splice(k,1):k++}for(k=0;k<a.length;k++)f=a[k],"br"===f.kind||"preserve"===f.space?k++:/[ ]$/.test(f.text)&&(k===a.length-
1||e(a[k+1]))&&(f.text=f.text.slice(0,-1))}function a(c,e){for(var f in c.contents){var k=c.contents[f],x=k.styleAttrs[m.byName.ruby.qname];if("span"!==k.kind||"textContainer"!==x&&"text"!==x)"contents"in k?a(k,e):("span"===k.kind&&0!==k.text.length||"br"===k.kind)&&e.push(k)}}function e(a){if("br"===a.kind)return!1;if("text"in a)return 0===a.text.length;if("contents"in a){for(var c=a.contents.length;c--;)e(a.contents[c])&&a.contents.splice(c,1);return 0===a.contents.length}}function x(a){this.contents=
[];this.aspectRatio=a.aspectRatio}function c(a){this.kind=a.kind||"region";a.id&&(this.id=a.id);this.styleAttrs={};for(var c in a.styleAttrs)this.styleAttrs[c]=a.styleAttrs[c];"src"in a&&(this.src=a.src);"type"in a&&(this.type=a.type);if("text"in a)this.text=a.text;else if("region"===this.kind||"contents"in a)this.contents=[];"space"in a&&(this.space=a.space)}f.generateISD=function(a,c,e){var f=new x(a),k={},d;for(d in a.head.layout.regions){var h=w(a,c,a.head.layout.regions[d],a.body,null,"",a.head.layout.regions[d],
e,k);null!==h&&f.contents.push(h.element)}return f};var M=[m.byName.color.qname,m.byName.textCombine.qname,m.byName.textDecoration.qname,m.byName.textEmphasis.qname,m.byName.textOutline.qname,m.byName.textShadow.qname]})("undefined"===typeof q?this.imscISD={}:q,"undefined"===typeof imscNames?f("./names"):imscNames,"undefined"===typeof imscStyles?f("./styles"):imscStyles,"undefined"===typeof imscUtils?f("./utils"):imscUtils)},{"./names":5,"./styles":6,"./utils":7}],4:[function(f,t,q){q.generateISD=
f("./isd").generateISD;q.fromXML=f("./doc").fromXML;q.renderHTML=f("./html").render},{"./doc":1,"./html":2,"./isd":3}],5:[function(f,t,q){f="undefined"===typeof q?this.imscNames={}:q;f.ns_tt="http://www.w3.org/ns/ttml";f.ns_tts="http://www.w3.org/ns/ttml#styling";f.ns_ttp="http://www.w3.org/ns/ttml#parameter";f.ns_xml="http://www.w3.org/XML/1998/namespace";f.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling";f.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter";f.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt";
f.ns_ebutts="urn:ebu:tt:style";f.ttaf_map={"http://www.w3.org/2006/10/ttaf1":f.ns_tt,"http://www.w3.org/2006/10/ttaf1#style":f.ns_tts,"http://www.w3.org/2006/10/ttaf1#parameter":f.ns_ttp}},{}],6:[function(f,t,q){(function(f,n,m){function l(a,e,f,c,m,k,l,n){this.name=e;this.ns=a;this.qname=a+" "+e;this.inherit=m;this.animatable=k;this.initial=f;this.applies=c;this.parse=l;this.compute=n}f.all=[new l(n.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,m.parseColor,null),
new l(n.ns_tts,"color","white",["span"],!0,!0,m.parseColor,null),new l(n.ns_tts,"direction","ltr",["p","span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(a){return a},null),new l(n.ns_tts,"displayAlign","before",["region"],!1,!0,function(a){return a},null),new l(n.ns_tts,"extent","auto",["tt","region"],!1,!0,function(a){if("auto"===a)return a;var e=a.split(" ");if(2!==e.length)return null;a=m.parseLength(e[0]);return(e=m.parseLength(e[1]))&&
a?{h:e,w:a}:null},function(a,e,f,c,l){if("auto"===c)e=new m.ComputedLength(0,1);else if(e=m.toComputedLength(c.h.value,c.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===e)return null;if("auto"===c)a=new m.ComputedLength(1,0);else if(a=m.toComputedLength(c.w.value,c.w.unit,null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:e,w:a}}),new l(n.ns_tts,"fontFamily","default",["span"],!0,!0,function(a){a=a.split(",");var e=[],f;for(f in a)"'"!==a[f].charAt(0)&&'"'!==a[f].charAt(0)?
"default"===a[f]?e.push("monospaceSerif"):e.push(a[f]):e.push(a[f]);return e},null),new l(n.ns_tts,"shear","0%",["p"],!0,!0,m.parseLength,function(a,e,f,c){if("%"===c.unit)a=100<Math.abs(c.value)?100*Math.sign(c.value):c.value;else return null;return a}),new l(n.ns_tts,"fontSize","1c",["span"],!0,!0,m.parseLength,function(a,e,x,c,l){return m.toComputedLength(c.value,c.unit,null!==e?e.styleAttrs[f.byName.fontSize.qname]:a.cellLength.h,null!==e?e.styleAttrs[f.byName.fontSize.qname]:a.cellLength.h,a.cellLength.h,
a.pxLength.h)}),new l(n.ns_tts,"fontStyle","normal",["span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"fontWeight","normal",["span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"lineHeight","normal",["p"],!0,!0,function(a){return"normal"===a?a:m.parseLength(a)},function(a,e,x,c,l){if("normal"===c)a=c;else if(a=m.toComputedLength(c.value,c.unit,x.styleAttrs[f.byName.fontSize.qname],x.styleAttrs[f.byName.fontSize.qname],a.cellLength.h,a.pxLength.h),null===a)return null;return a}),new l(n.ns_tts,
"opacity",1,["region"],!1,!0,parseFloat,null),new l(n.ns_tts,"origin","auto",["region"],!1,!0,function(a){if("auto"===a)return a;var e=a.split(" ");if(2!==e.length)return null;a=m.parseLength(e[0]);return(e=m.parseLength(e[1]))&&a?{h:e,w:a}:null},function(a,e,f,c,l){if("auto"===c)e=new m.ComputedLength(0,0);else if(e=m.toComputedLength(c.h.value,c.h.unit,null,a.dimensions.h,null,a.pxLength.h),null===e)return null;if("auto"===c)a=new m.ComputedLength(0,0);else if(a=m.toComputedLength(c.w.value,c.w.unit,
null,a.dimensions.w,null,a.pxLength.w),null===a)return null;return{h:e,w:a}}),new l(n.ns_tts,"overflow","hidden",["region"],!1,!0,function(a){return a},null),new l(n.ns_tts,"padding","0px",["region"],!1,!0,function(a){a=a.split(" ");if(4<a.length)return null;var e=[],f;for(f in a){var c=m.parseLength(a[f]);if(!c)return null;e.push(c)}return e},function(a,e,l,c,n){if(1===c.length)e=[c[0],c[0],c[0],c[0]];else if(2===c.length)e=[c[0],c[1],c[0],c[1]];else if(3===c.length)e=[c[0],c[1],c[2],c[1]];else if(4===
c.length)e=[c[0],c[1],c[2],c[3]];else return null;c=l.styleAttrs[f.byName.writingMode.qname];if("lrtb"===c||"lr"===c)e=[e[0],e[3],e[2],e[1]];else if("rltb"===c||"rl"===c)e=[e[0],e[1],e[2],e[3]];else if("tblr"===c)e=[e[3],e[0],e[1],e[2]];else if("tbrl"===c||"tb"===c)e=[e[3],e[2],e[1],e[0]];else return null;c=[];for(var k in e)if(0===e[k].value)c[k]=new m.ComputedLength(0,0);else if(c[k]=m.toComputedLength(e[k].value,e[k].unit,l.styleAttrs[f.byName.fontSize.qname],"0"===k||"2"===k?l.styleAttrs[f.byName.extent.qname].h:
l.styleAttrs[f.byName.extent.qname].w,"0"===k||"2"===k?a.cellLength.h:a.cellLength.w,"0"===k||"2"===k?a.pxLength.h:a.pxLength.w),null===c[k])return null;return c}),new l(n.ns_tts,"position","top left",["region"],!1,!0,function(a){return m.parsePosition(a)},function(a,e,l,c){e=m.toComputedLength(c.v.offset.value,c.v.offset.unit,null,new m.ComputedLength(-l.styleAttrs[f.byName.extent.qname].h.rw,a.dimensions.h.rh-l.styleAttrs[f.byName.extent.qname].h.rh),null,a.pxLength.h);if(null===e)return null;"bottom"===
c.v.edge&&(e=new m.ComputedLength(-e.rw-l.styleAttrs[f.byName.extent.qname].h.rw,a.dimensions.h.rh-e.rh-l.styleAttrs[f.byName.extent.qname].h.rh));var x=m.toComputedLength(c.h.offset.value,c.h.offset.unit,null,new m.ComputedLength(a.dimensions.w.rw-l.styleAttrs[f.byName.extent.qname].w.rw,-l.styleAttrs[f.byName.extent.qname].w.rh),null,a.pxLength.w);if(null===e)return null;"right"===c.h.edge&&(x=new m.ComputedLength(a.dimensions.w.rw-x.rw-l.styleAttrs[f.byName.extent.qname].w.rw,-x.rh-l.styleAttrs[f.byName.extent.qname].w.rh));
return{h:e,w:x}}),new l(n.ns_tts,"ruby","none",["span"],!1,!0,function(a){return a},null),new l(n.ns_tts,"rubyAlign","center",["span"],!0,!0,function(a){return"center"!==a&&"spaceAround"!==a?null:a},null),new l(n.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"rubyReserve","none",["p"],!0,!0,function(a){var e=a.split(" ");a=[null,null];if(0===e.length||2<e.length||"none"!==e[0]&&"both"!==e[0]&&"after"!==e[0]&&"before"!==e[0]&&"outside"!==e[0])return null;
a[0]=e[0];if(2===e.length&&"none"!==e[0])if(e=m.parseLength(e[1]))a[1]=e;else return null;return a},function(a,e,l,c,n){if("none"===c[0])return c;a=null===c[1]?new m.ComputedLength(.5*l.styleAttrs[f.byName.fontSize.qname].rw,.5*l.styleAttrs[f.byName.fontSize.qname].rh):m.toComputedLength(c[1].value,c[1].unit,l.styleAttrs[f.byName.fontSize.qname],l.styleAttrs[f.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);return null===a?null:[c[0],a]}),new l(n.ns_tts,"showBackground","whenActive",["region"],
!1,!0,function(a){return a},null),new l(n.ns_tts,"textAlign","start",["p"],!0,!0,function(a){return a},function(a,e,f,c,m){return"left"===c?"start":"right"===c?"end":c}),new l(n.ns_tts,"textCombine","none",["span"],!0,!0,function(a){a=a.split(" ");return 1!==a.length||"none"!==a[0]&&"all"!==a[0]?null:[a[0]]},null),new l(n.ns_tts,"textDecoration","none",["span"],!0,!0,function(a){return a.split(" ")},null),new l(n.ns_tts,"textEmphasis","none",["span"],!0,!0,function(a){a=a.split(" ");var e={style:null,
symbol:null,color:null,position:null},f;for(f in a)if("none"===a[f]||"auto"===a[f])e.style=a[f];else if("filled"===a[f]||"open"===a[f])e.style=a[f];else if("circle"===a[f]||"dot"===a[f]||"sesame"===a[f])e.symbol=a[f];else if("current"===a[f])e.color=a[f];else if("outside"===a[f]||"before"===a[f]||"after"===a[f])e.position=a[f];else if(e.color=m.parseColor(a[f]),null===e.color)return null;null==e.style&&null==e.symbol?e.style="auto":(e.symbol=e.symbol||"circle",e.style=e.style||"filled");e.position=
e.position||"outside";e.color=e.color||"current";return e},null),new l(n.ns_tts,"textOutline","none",["span"],!0,!0,function(a){if("none"===a)return a;var e={};a=a.split(" ");if(0===a.length||2<a.length)return null;var f=m.parseColor(a[0]);e.color=f;null!==f&&a.shift();if(1!==a.length)return null;a=m.parseLength(a[0]);if(!a)return null;e.thickness=a;return e},function(a,e,l,c,n){if("none"===c)return c;e={};e.color=null===c.color?l.styleAttrs[f.byName.color.qname]:c.color;e.thickness=m.toComputedLength(c.thickness.value,
c.thickness.unit,l.styleAttrs[f.byName.fontSize.qname],l.styleAttrs[f.byName.fontSize.qname],a.cellLength.h,a.pxLength.h);return null===e.thickness?null:e}),new l(n.ns_tts,"textShadow","none",["span"],!0,!0,m.parseTextShadow,function(a,e,l,c){if("none"===c)return c;e=[];for(var n in c){var k={};k.x_off=m.toComputedLength(c[n][0].value,c[n][0].unit,null,l.styleAttrs[f.byName.fontSize.qname],null,a.pxLength.w);if(null===k.x_off)return null;k.y_off=m.toComputedLength(c[n][1].value,c[n][1].unit,null,
l.styleAttrs[f.byName.fontSize.qname],null,a.pxLength.h);if(null===k.y_off)return null;if(null===c[n][2])k.b_radius=0;else if(k.b_radius=m.toComputedLength(c[n][2].value,c[n][2].unit,null,l.styleAttrs[f.byName.fontSize.qname],null,a.pxLength.h),null===k.b_radius)return null;k.color=null===c[n][3]?l.styleAttrs[f.byName.color.qname]:c[n][3];e.push(k)}return e}),new l(n.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(a){return a},null),new l(n.ns_tts,"visibility","visible",["body","div","p",
"region","span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(a){return a},null),new l(n.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(a){return a},null),new l(n.ns_tts,"zIndex","auto",["region"],!1,!0,function(a){"auto"!==a&&(a=parseInt(a),isNaN(a)&&(a=null));return a},null),new l(n.ns_ebutts,"linePadding","0c",["p"],!0,!1,m.parseLength,function(a,e,f,c,l){return m.toComputedLength(c.value,c.unit,null,null,a.cellLength.w,null)}),new l(n.ns_ebutts,
"multiRowAlign","auto",["p"],!0,!1,function(a){return a},null),new l(n.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(a){return a},null),new l(n.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(a){return"true"===a?!0:!1},null),new l(n.ns_itts,"fillLineGap","true",["p"],!0,!0,function(a){return"true"===a?!0:!1},null)];f.byQName={};for(var q in f.all)f.byQName[f.all[q].qname]=f.all[q];f.byName={};for(var w in f.all)f.byName[f.all[w].name]=f.all[w]})("undefined"===
typeof q?this.imscStyles={}:q,"undefined"===typeof imscNames?f("./names"):imscNames,"undefined"===typeof imscUtils?f("./utils"):imscUtils)},{"./names":5,"./utils":7}],7:[function(f,t,q){(function(f){var n=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,m=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,l=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,q={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,
0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};f.parseColor=function(a){var e,f=null,c=q[a.toLowerCase()];void 0!==c?f=c:null!==(e=n.exec(a))?f=[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),void 0!==e[4]?parseInt(e[4],16):255]:null!==(e=m.exec(a))?f=[parseInt(e[1]),
parseInt(e[2]),parseInt(e[3]),255]:null!==(e=l.exec(a))&&(f=[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4])]);return f};var t=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;f.parseLength=function(a){var e,f=null;null!==(e=t.exec(a))&&(f={value:parseFloat(e[1]),unit:e[2]});return f};f.parseTextShadow=function(a){a=a.split(",");var e=[],l;for(l in a){var c=a[l].split(" ");if(1===c.length&&"none"===c[0])return"none";if(1<c.length&&5>c.length){var m=[null,null,null,null],k=f.parseLength(c.shift());
if(null===k)return null;m[0]=k;k=f.parseLength(c.shift());if(null===k)return null;m[1]=k;if(0!==c.length&&(k=f.parseLength(c[0]),null!==k&&(m[2]=k,c.shift()),0!==c.length)){c=f.parseColor(c[0]);if(null===c)return null;m[3]=c}e.push(m)}}return e};f.parsePosition=function(a){a=a.split(" ");var e=function(a){return"center"===a||"left"===a||"top"===a||"bottom"===a||"right"===a};if(4<a.length)return null;for(var l in a)if(!e(a[l])){var c=f.parseLength(a[l]);if(null===c)return null;a[l]=c}l={h:{edge:"left",
offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}};for(c=0;c<a.length;){var m=a[c++];if(e(m)){var k={value:0,unit:"%"};2!==a.length&&c<a.length&&!e(a[c])&&(k=a[c++]);"right"===m?(l.h.edge=m,l.h.offset=k):"bottom"===m?(l.v.edge=m,l.v.offset=k):"left"===m?l.h.offset=k:"top"===m&&(l.v.offset=k)}else if(1===a.length||2===a.length)1===c?l.h.offset=m:l.v.offset=m;else return null}return l};f.ComputedLength=function(a,e){this.rw=a;this.rh=e};f.ComputedLength.prototype.toUsedLength=function(a,
e){return a*this.rw+e*this.rh};f.ComputedLength.prototype.multiply=function(a,e){return e?a*e:a};f.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh};f.toComputedLength=function(a,e,l,c,m,k){return"%"===e&&c?new f.ComputedLength(c.rw*a/100,c.rh*a/100):"em"===e&&l?new f.ComputedLength(l.rw*a,l.rh*a):"c"===e&&m?new f.ComputedLength(a*m.rw,a*m.rh):"px"===e&&k?new f.ComputedLength(a*k.rw,a*k.rh):"rh"===e?new f.ComputedLength(0,a/100):"rw"===e?new f.ComputedLength(a/100,0):null}})("undefined"===
typeof q?this.imscUtils={}:q)},{}]},{},[4])(4)});
